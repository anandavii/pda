---
title: "FinalProject_itmd514_05_Group4"
author: "Abhishek Anand, Apurva Anand, Surajit Patra"
date: "2024-12-03"
output: html_document
---

```{r}
# We will require the tidyverse library, ISLR2 library and the dplyr library
# The following loads the library for our use
library(tidyverse)
library(knitr)
library(ggplot2)
library(gridExtra)
```

```{r}																									
# Import data file for nlsy97
nlsy <- read_csv("nlsy97.csv")
```																									
																									
```{r}																									
# Looking at the data
glimpse(nlsy)
```																									
																									
			
```{r}
# Change column names to meaningful
colnames(nlsy)[colnames(nlsy) == "R0536300"] <- "gender"
colnames(nlsy)[colnames(nlsy) == "R0536402"] <- "birth_year"
colnames(nlsy)[colnames(nlsy) == "R0690800"] <- "is_sad_depressed_unhappy_f"
colnames(nlsy)[colnames(nlsy) == "R1201400"] <- "current_enrollment_status"
colnames(nlsy)[colnames(nlsy) == "U2857200"] <- "total_income_2016"
colnames(nlsy)[colnames(nlsy) == "R1482600"] <- "race"
colnames(nlsy)[colnames(nlsy) == "T6767000"] <- "highest_grade_completed"
colnames(nlsy)[colnames(nlsy) == "R1194000"] <- "age_1996"
colnames(nlsy)[colnames(nlsy) == "R1201300"] <- "citizenship"
colnames(nlsy)[colnames(nlsy) == "R0358900"] <- "used_marijuana"
colnames(nlsy)[colnames(nlsy) == "T7731100"] <- "industry_code"
colnames(nlsy)[colnames(nlsy) == "U1852400"] <- "marital_status"
colnames(nlsy)[colnames(nlsy) == "E8043100"] <- "total_num_incarcerations"
colnames(nlsy)[colnames(nlsy) == "T6650100"] <- "college_type"
colnames(nlsy)[colnames(nlsy) == "S0920700"] <- "trustful_or_not"
```

```{r}
# Creating a df with renamed columns
nlsy_df <- nlsy[, c(
  "gender",
  "birth_year",
  "is_sad_depressed_unhappy_f",
  "current_enrollment_status",
  "total_income_2016",
  "race",
  "highest_grade_completed",
  "age_1996",
  "citizenship",
  "used_marijuana",
  "industry_code",
  "marital_status",
  "total_num_incarcerations",
  "college_type",
  "trustful_or_not"
)]
```

## GENDER																									
```{r}																									
# Check the unique values and if any missing values are present
unique(nlsy_df$gender)
table(nlsy_df$gender, useNA = "ifany")
```																									
As we can see here we have a total of 4599 male and 4385 females which are denoted by 1 and 2 factor levels.																									
																									
```{r}																									
# Convert gender to a factor with Male and Female labels
nlsy_df <- nlsy_df %>%
  mutate(gender = factor(gender,
    levels = c(1, 2),
    labels = c("Male", "Female")
  ))
```																									
Renaming the factor level 1 and 2 in the gender column to Male and Female																									
																									
```{r}																									
# Verify the count of Male and Female in the data
nlsy_df %>%
  count(gender, sort = TRUE) %>%
  rename(count = n)
```																									
```{r}																									
# Gender Summary
ggplot(nlsy_df, aes(x = gender, fill = gender)) +
  geom_bar() +
  geom_text(aes(label = ..count..), stat = "count", vjust = 6, size = 6)
labs(title = "Gender Distribution Plot", x = "Gender", y = "Count")
```																									
																									
From the plot above we can see the population distribution contains more number of Male(4599) and less Females(4385).														
	
## BIRTH YEAR
```{r}
# Checking if birth_year column requires cleaning | unique values: 1983 1984 1980 1981 1982
# This variable birth_year does not contain any negative values and hence no cleaning is required for it. We have summarized the variable which tells minimum value expected is 1980, 1st quartile is 1981, median is 1982, 3rd quartile is 1983 and max is 1984.
sort(unique(nlsy_df$birth_year))
summary(nlsy_df$birth_year)
```

```{r}
# This will give us an idea pf count of responses for each type for Birth year.
# The tibble is 5x2 which shows the range of birth year in the survey responses and count of respondants having those birth year, like there are 1874 people having 1981 as the birth year, 1841 people having 1982 as the birth year, 1807 responses for 1983 birth year, 1771 responses for 1984 birth year, and 1691 responses for 1980 birth year.
nlsy_df %>%
  count(birth_year, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting birth year and its concentration
ggplot(data = nlsy_df, aes(x = birth_year, fill = birth_year)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Birth Year of the respondants",
    x = "Birth Year", y = "Count",
  ) +
  scale_fill_brewer(palette = "Set2", name = "birthyear") +
  theme_minimal()
```

## IS SAD DEPRESSED UNHAPPY F
```{r}
# Replace -3, -4, and -5 with NA in the is_sad_depressed_unhappy_f column
# is_sad_depressed_unhappy_f is a primary variable captured in survey year 1997 to see how respondents respond to the question if they are sad, unhappy, or depressed. This variable has 1070 responses for 0 which signifies 'Not true', 472 responses for 1 which signifies 'Sometimes true', and 42 responses for which signifies 'Often true'. Out of total 8984, there are 1584 valid responses and some have negative values like -1(2),-2(2),-4 (7396),-5 which signify refusal, don't know, valid skip, non-interview, respectively. Here we are replacing -3,-4,-5 with NA and then filtering nlsy_df with all NA for this variable. This means that 7400/8984 data is NA which constitutes a huge portion of data and may introduce biases.

nlsy_df <- nlsy_df %>%
  mutate(
    is_sad_depressed_unhappy_f = ifelse(is_sad_depressed_unhappy_f %in% c(-1, -2, -3, -4, -5), NA, is_sad_depressed_unhappy_f)
  )

# Verify the changes
table(nlsy_df$is_sad_depressed_unhappy_f, useNA = "always")

# Omit rows where is_sad_depressed_unhappy_f is NA
# nlsy_df <- nlsy_df %>%
#  filter(!is.na(is_sad_depressed_unhappy_f))
sort(unique(nlsy_df$is_sad_depressed_unhappy_f))

glimpse(nlsy_df)
```



```{r}
# This question 'Is the respondant sad, unhappy, or depressed?' shows a tibble 4x2 where we have marked 0 as Not true, 1 as Sometimes true, 2 as Often true, and for all negative values we have used NA. The table below shows the count of each kind of responses.
nlsy_df <- nlsy_df %>%
  mutate(is_sad_depressed_unhappy_f = case_when(
    is_sad_depressed_unhappy_f == 0 ~ "Not true",
    is_sad_depressed_unhappy_f == 1 ~ "Sometimes true",
    is_sad_depressed_unhappy_f == 2 ~ "Often true",
    is_sad_depressed_unhappy_f < -2 ~ NA_character_
  ))
```

```{r}
# This will give us an idea pf count of responses for each type of responses.
nlsy_df %>%
  count(is_sad_depressed_unhappy_f, sort = TRUE) %>%
  rename(count = n)
```


```{r}
# Omit rows where is_sad_depressed_unhappy_f is NA
Is_Sad_plot_df <- nlsy_df %>%
  filter(!is.na(is_sad_depressed_unhappy_f))
# Plotting is_sad_depressed_unhappy_f and count
ggplot(data = Is_Sad_plot_df, aes(x = is_sad_depressed_unhappy_f, fill = is_sad_depressed_unhappy_f)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "Is the female respondant sad, unhappy, or depressed?",
    x = "Is Sad, Depressed, or Unhappy (Females)", y = "Count",
  ) +
  scale_fill_brewer(palette = "Set2", name = "Type of Responses") +
  theme_minimal()
```

## ENROLLMENT STATUS																									
```{r}																									
# Check for unique values and if any missing values are present
unique(nlsy_df$current_enrollment_status)
table(nlsy_df$current_enrollment_status, useNA = "ifany")
```																									
There exist 2 values indicating Don't Know, denoted by -2																									
																									
```{r}																									
# Changing factor levels for current_enrollment_status into labels
nlsy_df <- nlsy_df %>%
  mutate(current_enrollment_status = case_when(
    current_enrollment_status == 1 ~ "Not enrolled, no high school degree, no GED",
    current_enrollment_status == 2 ~ "Not enrolled, GED",
    current_enrollment_status == 3 ~ "Not enrolled, high school degree",
    current_enrollment_status == 4 ~ "Not enrolled, some college",
    current_enrollment_status == 5 ~ "Not enrolled, 2-year college graduate",
    current_enrollment_status == 6 ~ "Not enrolled, 4-year college graduate",
    current_enrollment_status == 7 ~ "Not enrolled, graduate degree",
    current_enrollment_status == 8 ~ "Enrolled in grades 1-12, not a high school graduate",
    current_enrollment_status == 9 ~ "Enrolled in a 2-year college",
    current_enrollment_status == 10 ~ "Enrolled in a 4-year college",
    current_enrollment_status == 11 ~ "Enrolled in a graduate program",
    current_enrollment_status < 0 ~ NA_character_
  ))
```																									
In the above we have lebelled the enrollment statuses and also changed the negative  values with NA the count of which is only 2 rows which is 2/8984 rows and ~0.02% of total data.																									
																									
```{r}																									
# Verify the count of different enrollment statuses
nlsy_df %>%
  count(current_enrollment_status, sort = TRUE) %>%
  rename(count = n)
```																									
From the table above we observe that 8742 of the respondants said that their current enrollment status is "Enrolled in grades 1-12, not a high school graduate" and this is followed by the ones who responsded "Not enrolled, no high school degree, no GED	" which is 226.


## TOTAL INCOME 2016
```{r} 
# Check the data
unique(nlsy_df$total_income_2016)
```

```{r}
# Handle negative values and replace with NA
nlsy_df <- nlsy_df %>%
  mutate(total_income_2016 = ifelse(total_income_2016 < 0, NA, total_income_2016))
```

```{r}
# Summarize the total_income_2016 column
summary(nlsy_df$total_income_2016)

# Count the number of missing values
sum(is.na(nlsy_df$total_income_2016))

# Calculate the percentage of missing values
sum(is.na(nlsy_df$total_income_2016)) / nrow(nlsy_df) * 100
```

From the above we can see that the missing values(NA) are 3893 which is 43.33% of the total data which might lead to bias. The mean is 49447 which is likely lower than the expected value due to the topcoding for the top 2%. The maximum income is 235884 which is also not the actual highest income but represents the average of the topcoded values. The median income is $40,000, and the interquartile range (IQR) spans from $25,000 to $62,000.


```{r}
# Number of Topcoded values(repondents with higher income)
topcoded <- with(nlsy_df, sum(total_income_2016 == max(total_income_2016, na.rm = TRUE), na.rm = TRUE))
topcoded
```   

There are 121 topcoded values present with the income of $235,884. These 121 respondants are among the top 2% of the earners and are given an average value of $235,884

```{r}
# Summarize the total_income_2016 column excluding topcoded values and removing NA rows
nlsy_no_topcoded <- nlsy_df %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))
summary(nlsy_no_topcoded$total_income_2016)
```

We have removed the respondents response who were hiding info or their responses could not be captured for their income in 2016.
After removing the topcoded values it lowers the mean income from $49,477 to $44,939. The maximum income also drops from $235,884 to $149,000, which is the actual cutoff for the topcoded group. The median and IQR remain largely unchanged, showing that the central distribution of income is not significantly affected by the exclusion of topcoded values.


```{r}
# Visualizing income distribution histogram including the topcoded values
plot1 <- ggplot(nlsy_df, aes(x = total_income_2016)) +
  geom_histogram(bins = 30, fill = "purple", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig1. Total Income 2016",
    subtitle = "Including Topcoded values",
    x = "Total Income for 2016",
    y = "Frequency on income"
  )

# Visualizing income distribution boxplot  including the topcoded values
plot2 <- ggplot(nlsy_df, aes(y = total_income_2016)) +
  geom_boxplot(fill = "cyan", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig1.1 Total Income 2016",
    subtitle = "Including Topcoded values",
    y = "Total Income"
  )

# Visualizing income distribution histogram excluding the topcoded values
nlsy_no_topcoded <- nlsy_df %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))

plot3 <- ggplot(nlsy_no_topcoded, aes(x = total_income_2016)) +
  geom_histogram(bins = 30, fill = "purple", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig2. Total Income 2016",
    subtitle = "Excluding Topcoded values",
    x = "Total Income for 2016",
    y = "Frequency on income"
  )

# Visualizing income distribution boxplot excluding the topcoded values
plot4 <- ggplot(nlsy_no_topcoded, aes(y = total_income_2016)) +
  geom_boxplot(fill = "cyan", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig2.1 Total Income 2016",
    subtitle = "Excluding Topcoded values",
    y = "Total Income"
  )

grid.arrange(plot1, plot2, plot3, plot4, ncol = 2)
```   

In the above we see that the income is topcoded and the value for the top 2% earners is replaced with average income of this group. In Fig1. the histogram is right skewed which means that there are very few high income earners but most earners make less and this skewness shows that the majority of the population earns much less than this topcoded value.

In Fig1.1 the boxplot for the same data shows that the median income is around $40,000, and the Interquartile Range (IQR) spans from $25,000 to $62,000. This means that 50% of the individuals' incomes fall within this range. The plot also identifies the topcoded value as an outlier at $235,884, which is far outside the typical income range. 

In Fig 2.when the topcoded values are removed, the histogram shows a more accurate representation of the income distribution, with the right skew still present but less extreme. This plot offers a more realistic view of the income structure, showing that the vast majority of individuals earn significantly less than $235,884.

Similarly in Fig2.1 the boxplot, now excluding the topcoded values, shows a median income of $35,000 and a more concentrated IQR of $25,000 to $50,000. By removing the topcoded value, the outlier is eliminated, and the distribution is more representative of the actual income spread. This boxplot highlights the more typical income range for most individuals, without the distortion introduced by the topcoded values.
	
## RACE																								
```{r}																									
# Check for unique values and if any missing values are present
unique(nlsy_df$race)
table(nlsy_df$race, useNA = "ifany")
```																									
Here we can see that we have the valid values from 1-4 and this column does not contain any missing values as well. Now further we can encode the numeric values to the race/ethinicity.																									
																									
```{r}																									
# Recode race values into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(race = case_when(
    race == 1 ~ "Black",
    race == 2 ~ "Hispanic",
    race %in% c(3, 4) ~ "Other" # Combine "Mixed Race" and "Non-Black" into "Other"
  )) %>%
  mutate(race = factor(race, levels = c("Black", "Hispanic", "Other")))
```																									
																									
```{r}																									
# Count the number of respondents in each race group
nlsy_df %>%
  count(race, sort = TRUE) %>%
  rename(count = n)
```																									
From the count we can infer that the total population contains 2335 Black respondents, 1901 Hispanic, 4665 Non-Black and 83 Mixed Race in Others population.																									
																									
```{r}																									
# Race Summary
ggplot(nlsy_df, aes(x = reorder(race, -table(race)[race]), fill = race)) +
  geom_bar() +
  geom_text(aes(label = ..count..), stat = "count", vjust = 6, size = 6) +
  labs(
    title = "Race Distribution Plot", x = "Race", y = "Count",
    subtitle = "Note: 'Other' includes Mixed Race and Non-Black"
  )
```																									

## HIGHEST GRADE COMPLETED																							
```{r}
# Check for unique values and if any missing values are present
unique(nlsy$highest_grade_completed)
table(nlsy$highest_grade_completed, useNA = "ifany")
```
From the above we can see there are four types of negative values present which are -5, -4, -2 and -1 denoting non-interview, skipped, don't know and refusal. Further we have to encode the values with appropiriate labels.

```{r}
# Replace negative values with NA
nlsy <- nlsy %>%
  mutate(highest_grade_completed = ifelse(highest_grade_completed < 0, NA, highest_grade_completed))
```

```{r}
# Recode highest grade completed into descriptive labels
nlsy <- nlsy %>%
  mutate(highest_grade_completed = case_when(
    highest_grade_completed == 0 ~ "None",
    highest_grade_completed == 1 ~ "1st Grade",
    highest_grade_completed == 2 ~ "2nd Grade",
    highest_grade_completed == 3 ~ "3rd Grade",
    highest_grade_completed == 4 ~ "4th Grade",
    highest_grade_completed == 5 ~ "5th Grade",
    highest_grade_completed == 6 ~ "6th Grade",
    highest_grade_completed == 7 ~ "7th Grade",
    highest_grade_completed == 8 ~ "8th Grade",
    highest_grade_completed == 9 ~ "9th Grade",
    highest_grade_completed == 10 ~ "10th Grade",
    highest_grade_completed == 11 ~ "11th Grade",
    highest_grade_completed == 12 ~ "12th Grade",
    highest_grade_completed == 13 ~ "1st Year College",
    highest_grade_completed == 14 ~ "2nd Year College",
    highest_grade_completed == 15 ~ "3rd Year College",
    highest_grade_completed == 16 ~ "4th Year College",
    highest_grade_completed == 17 ~ "5th Year College",
    highest_grade_completed == 18 ~ "6th Year College",
    highest_grade_completed == 19 ~ "7th Year College",
    highest_grade_completed == 20 ~ "8th Year College or More",
    highest_grade_completed == 95 ~ "Ungraded",
    highest_grade_completed < 0 ~ NA_character_
  ))
```

```{r}
# Verify the count of different grades
nlsy %>%
  count(highest_grade_completed, sort = TRUE) %>%
  rename(count = n)
```
From above we see that majority of the population did not answer about their grades which is 7436. From the remaining we can see that the majority of population completed 2nd year college(277) followed by 1st year college(213).

```{r}
# Create the plot with proper count calculation
ggplot(nlsy, aes(x = reorder(highest_grade_completed, table(highest_grade_completed)[highest_grade_completed]), fill = highest_grade_completed)) +
  geom_bar(stat = "count", show.legend = FALSE) +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 3) +
  labs(title = "Distribution of Highest Grade Completed", x = "Highest Grade Completed", y = "Count") +
  theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
```
From the above we see that theere are missing values for the majority of responses which is 7436. From the remaining we can see that the majority of population completed 2nd year college(277) followed by 1st year college(213).

## AGE as of 1996 December 31st
```{r}
# Checking if Age as of 1996 december 31st needs cleaning | unique values: 13 12 16 15 14
# The variable Age shows the minimum expected value in survey response is 12, 1st quartile is 13, median is 14, mean is 13.99, 3rd quartile is 15, and max is 16. This variable does not have any missing values and hence no cleaning is required.
unique(nlsy_df$age_1996)
summary(nlsy_df$age_1996)
```


```{r}
# The tabular form of data displayed below shows the age and number of people having that age.
nlsy_df %>%
  count(age_1996, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting age and its concentration
ggplot(data = nlsy_df, aes(x = age_1996, fill = age_1996)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Age of the respondants as of 21/31/1996",
    x = "Age (as of 12/31/1996)", y = "Count",
  ) +
  theme_minimal()
```
	
## CITIZENSHIP
```{r}
# Checking if Citizenship requires cleaning | unique values:  1 3 2 -4
# Citizenship is a variable have 1,2,3 as response in the survey and -4, a negative value indicating Valid Skip. We will be cleaning this variable to replace -4 in the data with NA. Furthermore, summarizing this variable we get min value as -4 ( which will be treated later), 1st quartile is 1, median is 1, mean is 0.6279, 3rd quartile is 1, and max is 3.
unique(nlsy_df$citizenship)
summary(nlsy_df$citizenship)
```

```{r}
# The tabular form of data displayed below shows the age and number of people having that age.
# Here we see that there is a significant number of responses with negative value in our data set for Citizenship variable. If we change -4 to NA, then 1042 data will be omitted when we plot it which might introduce biases in the data and the output might not be accurate.
nlsy_df %>%
  count(citizenship, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Replace -4 with NA in the Citizenship column
nlsy_df <- nlsy_df %>%
  mutate(
    citizenship = ifelse(citizenship %in% c(-4), NA, citizenship)
  )

# Verify the changes
table(nlsy_df$citizenship, useNA = "always")
```


```{r}
# For this question 'What is the citizenship', we have marked 1 as Citizen, born in the U.S., 2 as Unknown, not born in U.S., 3 as Unknown, not born in U.S., and for all negative values we have used NA. The table below shows the count of each kind of responses.
nlsy_df <- nlsy_df %>%
  mutate(citizenship = case_when(
    citizenship == 1 ~ "Citizen",
    citizenship == 2 ~ "Birthplace Unknown",
    citizenship == 3 ~ "Non-Citizen",
    citizenship < 1 ~ NA_character_
  ))
```

```{r}
# Upon mutating values for citizenship to make it categorical we have replaced -4 with NA for 1042 rows, 1 with Citizen, born in the U.S., 2 with Unknown, not born in U.S., 3 with Unknown, can't determine birthplace, and anything less than 1 with NA. This helps us in easily reading the analysis.
nlsy_df %>%
  count(citizenship, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting citizenship and its concentration
ggplot(data = nlsy_df, aes(x = citizenship, fill = citizenship)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Citizenship of the respondant",
    x = "Citizenship", y = "Count",
  ) +
  theme_minimal()
# The graph below shows how the response is ranged across. It illustrates that majority of the respondants have a citizenship of the U.S. and constitutes to 6869 out of 8984, some don't know their birthplace constitute to 794, some who were not born in the U.S. adds up to 279, and the remaining 1042 were all missing data. This, we can say that 76.45% of the people were born in the U.S., 3.1% were not born in the U.S, 8.83% cannot determine their birthplace, and 11.5% of significant population skipped the question.
```

## EVER USE MARIJUANA
```{r}
# This variable Citizenship has different values like Non-Citizen, Birthplace Unknown, Citizen , and NA. Possible responses are 0,1,-1,-2,-3 where 0 indicates No, 1 indicates Yes, -1 indicates Refusal, -2 indicates Don't know, and -3 indicates Invalid Skip. To clean this we will be taking -1 and -2 into consideration as it can tell us if respondents might be hiding the truth. However, we can replace -3 with NA to get the accurate analysis done for this variable.
unique(nlsy_df$used_marijuana)
summary(nlsy_df$used_marijuana)
```

```{r}
# To clean the variable Used Marijuana, we are performing following steps like converting to categorical values for ease of analysis.
# Replace -3 with NA in the Used_Marijuana
nlsy_df <- nlsy_df %>%
  mutate(
    used_marijuana = ifelse(used_marijuana %in% c(-3), NA, used_marijuana)
  )

# Verify the changes
table(nlsy_df$used_marijuana, useNA = "always")
```

```{r}
# Here we have different factor levels like Don't know, Refusal, No, Yes for Factor used_marijuana.
nlsy_df <- nlsy_df %>%
  mutate(used_marijuana = factor(used_marijuana, levels = c(-2, -1, 0, 1), labels = c("Don't Know", "Refusal", "No", "Yes")))
```

```{r}
# Upon factoring values for used_marihjuana to make it categorical we have replaced -3 with NA for 2 rows, 1 with Yes, 0 with No, -1 with Refusal, and -2 with don't know. This helps us in easily reading the analysis.
nlsy_df %>%
  count(used_marijuana, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting used_marijuana
ggplot(data = nlsy_df, aes(x = reorder(used_marijuana, -table(used_marijuana)[used_marijuana]), fill = used_marijuana)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "Have you ever used marijuana?",
    x = "Used Marijuana", y = "Count",
  ) +
  scale_fill_brewer(palette = "Set3", name = "Type of Responses") +
  theme_minimal()
# The graph below illustrates that 79.56% (7148) of respondents do not use marijuana, 19.97% (1795) use marijuana, 0.05% (5) don't know if the used it, 0.37% (34) refused to answer the question, and the question was a invalid skip for 2 people. By this plot, we can say that 0.43% (39) people might be hiding some information on use of marijuana. There is a significant number of respondents who use marijuana.
```

## INDUSTRY CODE                                                
```{r}                                                  
# Checking unique values in industry_code
unique(nlsy_df$industry_code)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$industry_code, useNA = "ifany")
```                                                 
                                                  
From the above, we observe:                                                 
                                                  
1561 values are NON-INTERVIEW (denoted by -5),                                                  
1128 values are VALID SKIP (denoted by -4),                                                 
129 values are Invalid Skip (denoted by -3).                                                  
                                                  
```{r}                                                  
# Recoding industry_code with descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(industry_code = case_when(
    industry_code >= 170 & industry_code <= 290 ~ "Agriculture, Forestry, and Fisheries",
    industry_code >= 370 & industry_code <= 490 ~ "Mining",
    industry_code >= 570 & industry_code <= 690 ~ "Utilities",
    industry_code == 770 ~ "Construction",
    industry_code >= 1070 & industry_code <= 3990 ~ "Manufacturing",
    industry_code >= 4070 & industry_code <= 4590 ~ "Wholesale Trade",
    industry_code >= 4670 & industry_code <= 5790 ~ "Retail Trade",
    industry_code == 5890 ~ "Arts, Entertainment, and Recreation Services",
    industry_code >= 6070 & industry_code <= 6390 ~ "Transportation and Warehousing",
    industry_code >= 6470 & industry_code <= 6780 ~ "Information and Communication",
    industry_code >= 6870 & industry_code <= 7190 ~ "Finance, Insurance, and Real Estate",
    industry_code >= 7270 & industry_code <= 7790 ~ "Professional and Related Services",
    industry_code >= 7860 & industry_code <= 8470 ~ "Educational, Health, and Social Services",
    industry_code >= 8560 & industry_code <= 8690 ~ "Entertainment, Accommodations, and Food Services",
    industry_code >= 8770 & industry_code <= 9290 ~ "Other Services",
    industry_code >= 9370 & industry_code <= 9590 ~ "Public Administration",
    industry_code >= 9670 & industry_code <= 9890 ~ "Active Duty Military",
    industry_code >= 9950 & industry_code <= 9990 ~ "ACS Special Codes",
    industry_code < 0 ~ NA_character_ # Handling special codes (-5, -4, -3)
  ))
```                                                 
                                                  
In the above we have lebelled the industry code and also changed the negative values with NA.                                                 
                                                  
```{r}                                                  
# Counting missing values
sum(is.na(nlsy_df$industry_code))
```                                                 
                                                  
The count of missing values is 1561+1128+129 = 2818 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$industry_code)) / nrow(nlsy_df) * 100
```                                                 
From the above we can see that the missing values(NA) are 2818 and the percentage can be calculated as 2818/8984*100 which is 31.37% of the total data which causes the data to be baised.                                                  
                                                  
```{r}                                                  
# Verifying the count of each industry_code
nlsy_df %>%
  count(industry_code, sort = TRUE) %>%
  rename(count = n)
``` 

```{r}
# Visualizing industry code distribution with a bar plot
ggplot(data = nlsy_df, aes(x = industry_code)) +
  geom_bar(fill = "pink", color = "black") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "Industry Code Distribution",
    x = "Industry Code Types",
    y = "Count"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```
                                                  
The industry_code variable shows that 2818 rows are missing, accounting for 31.38% of the dataset. The largest group belongs to Educational, Health, and Social Services (1378 respondents), followed by Professional and Related Services (813) and Entertainment, Accommodations, and Food Services (718). Smaller industries, like Utilities (38) and Active Duty Military (22), are least represented. The missing data introduces potential bias and should be accounted for in analysis.                                                  
                                                  
## MARITAL STATUS
```{r}                                                  
# Checking unique values
unique(nlsy_df$marital_status)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$marital_status, useNA = "ifany")
```                                                 
                                                  
There exists 2250 values indicating NON-INTERVIEW denoted by -5 and 62 values indicating Invalid Skip denoted by -3.                                                  
                                                  
```{r}                                                  
# Recode marital_status values into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(marital_status = case_when(
    marital_status == 0 ~ "Never-married",
    marital_status == 1 ~ "Married",
    marital_status %in% c(2, 3, 4) ~ "Other" # Combine "Separated", "Divorced", "Widowed"
  )) %>%
  mutate(marital_status = factor(marital_status, levels = c("Never-married", "Married", "Other")))
```                                                 
                                                  
In the above we have lebelled the marital status and also changed the negative values with NA.                                                  
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$marital_status))
```                                                 
The count of missing values is 2250+62 = 2312 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$marital_status)) / nrow(nlsy_df) * 100
```                                                 
From the above we can see that the missing values(NA) are 2312 and the percentage can be calculated as 2312/8984*100 i.e. 25.73% of the total data which causes the data to be baised.                                                  
```{r}                                                  
# Verifying the count of each industry_code
nlsy_df %>%
  count(marital_status, sort = TRUE) %>%
  rename(count = n)
```  


```{r}                                                  
# Visualizing marital status distribution with a bar plot
ggplot(data = nlsy_df, aes(x = marital_status, fill = marital_status)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Marital Status?",
    x = "Marital Status",
    y = "Count",
    subtitle = "Note: 'Other' includes Separated, Divorced and Widowed"
  ) +
  theme_minimal()
```                                                 

  
The marital_status distribution shows that the majority of respondents are Never-married (2766) or Married (3066). Smaller numbers are classified as "Other" (e.g., Separated, Divorced, Widowed). About 25.75% of the data is missing, which may introduce bias.                                                 
In the bar plot above, we can see that a significant portion of the dataset is missing marital status information, with about 25.75% of respondents not providing data due to non-interviews (-5) and invalid skips (-3). This missing data introduces potential bias in any analysis of marital status and should be carefully addressed. The largest groups in the marital status distribution are "Never-married" (2766 respondents) and "Married" (3066 respondents), with smaller numbers for "Divorced" (663), "Separated" (154), and "Widowed" (23). The distribution is relatively skewed towards those who are "Never-married" or "Married," while the other categories are underrepresented. The presence of missing data in a large proportion of respondents calls for caution, as it may affect the generalizability of any findings related to marital status in this sample.                                                 

## TOTAL NUM INCARCERATION
```{r}                                                  
# Checking unique values in total_num_incarcerations
unique(nlsy_df$total_num_incarcerations)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$total_num_incarcerations, useNA = "ifany")
```                                                 
                                                  
From the data, 21 rows are Invalid Skip (denoted by -3).                                                  
                                                  
```{r}                                                  
# Recoding total_num_incarcerations into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(total_num_incarcerations = case_when(
    total_num_incarcerations == 0 ~ "No incarcerations",
    total_num_incarcerations >= 1 & total_num_incarcerations <= 2 ~ "1 to 2 incarcerations",
    total_num_incarcerations >= 3 & total_num_incarcerations <= 4 ~ "3 to 4 incarcerations",
    total_num_incarcerations >= 5 & total_num_incarcerations <= 6 ~ "5 to 6 incarcerations",
    total_num_incarcerations >= 7 & total_num_incarcerations <= 8 ~ "7 to 8 incarcerations",
    total_num_incarcerations >= 9 & total_num_incarcerations <= 10 ~ "9 to 10 incarcerations",
    total_num_incarcerations >= 11 & total_num_incarcerations <= 12 ~ "11 to 12 incarcerations",
    total_num_incarcerations >= 13 & total_num_incarcerations <= 14 ~ "13 to 14 incarcerations",
    total_num_incarcerations >= 15 & total_num_incarcerations <= 16 ~ "15 to 16 incarcerations",
    total_num_incarcerations >= 17 & total_num_incarcerations <= 18 ~ "17 to 18 incarcerations",
    total_num_incarcerations >= 19 & total_num_incarcerations <= 20 ~ "19 to 20 incarcerations",
    total_num_incarcerations < 0 ~ NA_character_ # Handling special codes (-1, -2, -3)
  ))
```                                                 
                                                  
In the above we have lebelled the total_num_incarcerations and also changed the negative values with NA.                                                  
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$total_num_incarcerations))
```                                                 
                                                  
The count of missing values is 21 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$total_num_incarcerations)) / nrow(nlsy_df) * 100
```                                                 
                                                  
From the above we can see that the missing values(NA) are 21 and the percentage can be calculated as 21/8984*100 i.e. 0.23% of the total data.                                                  
                                                  
```{r}                                                  
# Verifying the count of total_num_incarcerations for different levels
nlsy_df %>%
  count(total_num_incarcerations, sort = TRUE) %>%
  rename(count = n)
```

```{r}                                                  
# Bar plot for college_type
ggplot(data = nlsy_df, aes(x = total_num_incarcerations)) +
  geom_bar(fill = "lightgreen", color = "black") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.4) +
  labs(
    title = "Total number of Incarcerations",
    x = "Number of Incarcerations",
    y = "Count"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0.8))
```  
                                                  
The distribution of total_num_incarcerations reveals that the majority of respondents (8054) reported "No incarcerations", indicating no contact with the criminal justice system. Smaller groups reported 1 to 2 incarcerations (716 respondents) and 3 to 4 incarcerations (146 respondents). Only 38 respondents reported 5 to 6 incarcerations, and even fewer experienced higher levels of incarceration: 7 respondents for 7 to 8 incarcerations, 1 respondent for 9 to 10 incarcerations, and 1 respondent for 11 to 12 incarcerations. With only 21 missing values (0.23%), the data is relatively complete for this variable.                                                  

## COLLEGE TYPE
```{r}                                                  
# Checking unique values in college_type
unique(nlsy_df$college_type)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$college_type, useNA = "ifany")
```                                                 
                                                  
From the data:                                                  
                                                  
1561 rows are NON-INTERVIEW (denoted by -5),                                                  
5937 rows are VALID SKIP (denoted by -4),                                                 
52 rows are Invalid Skip (denoted by -3).                                                 
                                                  
```{r}                                                  
# Changing factor levels for college_type into labels
nlsy_df <- nlsy_df %>%
  mutate(college_type = case_when(
    college_type == 1 ~ "Public institution",
    college_type == 2 ~ "Private not-for-profit institution",
    college_type == 3 ~ "Private for-profit institution",
    college_type < 0 ~ NA_character_ # Handling special codes (-1, -2, -3, -4, -5)
  ))
```                                                 
                                                  
In the above we have lebelled the college types and also changed the negative values with NA.                                                 
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$college_type))
```                                                 
                                                  
The count of missing values is 1561+5937+52 = 7550 rows.                                                  
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$college_type)) / nrow(nlsy_df) * 100
```                                                 
                                                  
From the above we can see that the missing values(NA) are 7550 and the percentage given by 7550/8984*100 i.e. 84.04% of the total data which causes the data to be baised.

```{r}                                                  
# Verifying the count of each industry_code
nlsy_df %>%
  count(college_type, sort = TRUE) %>%
  rename(count = n)
```  
                                                  
```{r}                                                  
# Bar plot for college_type
ggplot(data = nlsy_df, aes(x = college_type)) +
  geom_bar(fill = "orange", color = "black") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.2) +
  labs(
    title = "College Type Distribution",
    x = "College Type",
    y = "Count"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```                                                 

The college_type variable indicates the type of institution respondents attended. The majority of respondents (960) attended a Public institution, followed by 261 respondents who attended a Private for-profit institution, and 213 respondents who attended a Private not-for-profit institution. A significant portion of the data (7550 rows, approximately 84.04%) is missing or marked as NA due to NON-INTERVIEW, VALID SKIP, or Invalid Skip. This high proportion of missing data introduces potential bias and limits the generalizability of findings. The distribution suggests that public institutions dominate the sample, with relatively few respondents attending private institutions of either type.            

## TRUSTFUL OR NOT
```{r}                                                  
# Checking the data for unique values
unique(nlsy_df$trustful_or_not)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$trustful_or_not, useNA = "ifany")
```                                                 
                                                  
It can be seen that 1088 values are NON-INTERVIEW denoted by -5, 3005 values are VALID SKIP denoted by -4, 3 values are Don't Know denoted by -2 and 13 values are Refusal denoted by -1.                                                 
                                                  
```{r}                                                  
# Recode trustful_or_not values into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(trustful_or_not = case_when(
    trustful_or_not >= 1 & trustful_or_not <= 3 ~ "Distrustful",
    trustful_or_not >= 4 ~ "Trustful",
    trustful_or_not < 0 ~ NA_character_ # Handling special codes (-1, -2, -3, -4, -5)
  )) %>%
  mutate(trustful_or_not = factor(trustful_or_not, levels = c("Distrustful", "Trustful")))
```                                                 
                                                  
In the above we have lebelled the college types and also changed the negative values with NA.                                                 
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$trustful_or_not))
```                                                 
                                                  
The count of missing values is 4109 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$trustful_or_not)) / nrow(nlsy_df) * 100
```                                                 
                                                  
From the above we can see that the missing values(NA) are 4109 and the percentage given by 4109/8984*100 i.e. 45.73% of the total data which causes the data to be baised.                                                  

```{r}                                                  
# Verifying the count of each industry_code
nlsy_df %>%
  count(trustful_or_not, sort = TRUE) %>%
  rename(count = n)
```  
                                                  
```{r}                                                  
# Bar plot for trustful_or_not
ggplot(data = nlsy_df, aes(x = trustful_or_not, fill = trustful_or_not)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "IS Trustful or Distrustful",
    x = "Trustfulness",
    y = "Count"
  ) +
  theme_minimal()
```                                                 
                                                  
The trustful_or_not variable shows a high percentage of missing data (45.73%). Among the valid data, the "Trustful" group (values >= 4) has a higher count than the "Distrustful" group (values 1–3). The missing data should be carefully addressed to ensure reliable insights.

---------------------------------------------------------------------------------------------------------------------

#PART 2 Analysis

## INCOME vs GENDER
```{r}
# Summarize income by gender including topcoded variable, excluding NA

gender_income_summary <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>% # Exclude rows with NA in income
  group_by(gender) %>%
  summarize(
    count = n(),
    mean_income = round(mean(total_income_2016, na.rm = TRUE)),
    median_income = round(median(total_income_2016, na.rm = TRUE)),
    sd_income = round(sd(total_income_2016, na.rm = TRUE))
  )
print(gender_income_summary)

# Summarize income by gender excluding topcoded variable, excluding NA

# Excuding the top coded values
nlsy_no_topcoded <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))

gender_income_summary <- nlsy_no_topcoded %>%
  group_by(gender) %>%
  summarize(
    count = n(), # Count rows after filtering
    mean_income = round(mean(total_income_2016, na.rm = TRUE)),
    median_income = round(median(total_income_2016, na.rm = TRUE)),
    sd_income = round(sd(total_income_2016, na.rm = TRUE))
  )
print(gender_income_summary)
```



The above tabular summary for income by gender shows that males have a higher average income ($57,203) compared to females ($41,279), with a median income of $47,000 for males and $35,000 for females. The standard deviation is also higher for males ($44,712) than for females ($34,047), indicating greater income variability among males. Overall, males consistently earn more on average and have more variation in income compared to females.

```{r}
plot1 <- ggplot(nlsy_df, aes(x = gender, y = total_income_2016, fill = gender)) +
  geom_boxplot(show.legend = FALSE, na.rm = TRUE) +
  labs(
    title = "Fig1.Income Distribution by Gender",
    subtitle = "Including Topcoded values",
    x = "Gender",
    y = "Total Income"
  )

# Plot of Income with Gender excluding topcoded values
nlsy_no_topcoded <- nlsy_df %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))

plot2 <- ggplot(nlsy_no_topcoded, aes(x = gender, y = total_income_2016, fill = gender)) +
  geom_boxplot(show.legend = FALSE) +
  labs(
    title = "Fig2.Income Distribution by Gender",
    subtitle = "Excluding Topcoded values",
    x = "Gender",
    y = "Total Income"
  )

grid.arrange(plot1, plot2, ncol = 2)
```

The box plot shows the distribution of income by gender, highlighting key differences between males and females. Males have a higher median income (indicated by the middle line of the box) compared to females. The overall spread of income is wider for males, as shown by the larger interquartile range and longer whiskers, reflecting greater income variability. From this boxplot we can say that males tend to earn more and have more income variability compared to females.

## INCOME vs RACE

```{r}
# Calculate mean income by race and gender, excluding rows with NA in income
income_by_race_gender <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>% # Exclude rows where income is NA
  group_by(race, gender) %>%
  summarize(
    average_income = round(mean(total_income_2016, na.rm = TRUE)), # Calculate mean income
    count = n() # Count rows after filtering
  )
# Display the tabular summary
income_by_race_gender
```

From the above we can see that the average income and the number of individuals for each race-gender combination, highlighting clear disparities. Males consistently earn more than females across all racial groups, with the income gap being the largest in the "Other" group ($18,279 difference) and smallest in the "Black" group ($6,873 difference). Among racial groups, individuals in the "Other" category have the highest average income for both males ($64,519) and females ($46,240), followed by "Hispanic" and "Black" groups, where males earn $53,326 and $42,110, respectively. Within each race, males and females are nearly equally represented, though males slightly outnumber females in most cases. This data reveals significant income disparities by both race and gender.

```{r}
# Create the bar plot for income by race and gender including topcoded values
ggplot(nlsy_df, aes(x = race, y = total_income_2016, fill = gender)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge", show.legend = TRUE, na.rm = TRUE) +
  geom_text(
    aes(label = round(..y..)),
    stat = "summary", fun = "mean", position = position_dodge(width = 0.9), vjust = 6, size = 4
  ) +
  labs(
    title = "Income by Race and Gender",
    subtitle = "Including Topcoded values",
    x = "Race",
    y = "Average Income",
    fill = "Gender"
  )
```
The bar plot shows the average income by race and gender, with distinct bars for males and females within each racial group. The "Other" group has the highest average income for both males ($64,519) and females ($46,240), followed by "Hispanic" and "Black" groups. Males consistently earn more than females across all groups, with the gender gap largest in the "Other" group ($18,279) and smallest in the "Black" group ($6,873). The plot highlights significant income disparities both between races and genders.

## CITIZENSHIP vs INCOME
```{r}																									
# Summarize income by citizenship status by gender distribution
# The table below shows the count of respondents for different category of citizenship, mean_income, median_income, and standard deviation. Here we can see that the mean income for citizen is less than the non-citizen and people who don't know their birthplace have the highest mean income. However, the median income for non-citizen is the highest.Also, standard deviation for citizens is lowest compared to non-citizen and unknown birthplace category respondents. The NA consists of valid skip which means the question was not applicable to those respondants and hence we have omitted it. Therefore, the data we see for citizenship status in table or the graph will be for the 7942 responses as out of 8984 we omitted 1042 rows.

# Omit rows where Citizenship is NA
citizen_nlsy_df <- nlsy_df %>%
  filter(!is.na(citizenship))

citizenship_income_summary <- citizen_nlsy_df %>%
  group_by(citizenship) %>%
  summarize(
    count = n(),
    mean_income = mean(total_income_2016, na.rm = TRUE),
    median_income = median(total_income_2016, na.rm = TRUE),
    sd_income = sd(total_income_2016, na.rm = TRUE)
  )
print(citizenship_income_summary)
```		

```{r}																									
# Analyzing income with citizenship based on Gender. Here, citizenship is categorical variable. The graph shows a range from $0-$200,000. The pink box represent male and turquoise boxes represent females. Each box plot shows median, quantiles, and outliers. The graphs show population into four groups called birthplace unknown, citizen, and non-citizen. Males show high median incomes across all citizenship categories as compared to females in turquoise boxes. The median income for males is around $50K, while for females it is lower around $35K. We can also say that the 1st quartile for females lies even below the 25K mark, while for males, the 1st quantile is above the 30K mark. The outliers show dots above the whiskers reaching up to $235K. We can also say that the 1st quantile for female lies even below 25K mark while for male 1st quantile is above 30K mark. We can say that the income disparity between genders appear to be relatively consistent across different citizenship status. Citizens and non-citizens show a kind of similar distribution of income patterns. Also, the boxes are larger for males, which indicates more income variability for them. Having topcoded values gives more accurate median. If we truncate the top 2%, the mean might underestimate the true average.
ggplot(citizen_nlsy_df, aes(x = citizenship, y = total_income_2016, fill = gender)) +
  geom_boxplot(na.rm = TRUE) +
  scale_fill_manual(values = c("Male" = "#1f77b4", "Female" = "#ff7f0e")) +
  labs(
    title = "Income vs Citizenship Distribution by Gender",
    subtitle = "Including Topcoded Values",
    x = "Citizenship",
    y = "Total Income"
  )
```								

```{r}
# Filter the data before creating the plot to remove the topcoded values. As we know there are 121 people having topcoded which is 2% level. There income has been average to 235884 and we plan to analyse the data for both with topcoded and without.
no_topcoded_nlsy_df <- nlsy_df %>%
  filter(total_income_2016 < 235884)

# Graph with topcoded income values
ggplot(nlsy_df, aes(x = age_1996, y = total_income_2016, color = gender)) +
  geom_jitter(alpha = 0.6, width = 0.4, height = 0, na.rm = TRUE) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Fig1. Income vs Age (1996) by Gender",
    subtitle = "Including Topcoded Values",
    x = "Age in 1996",
    y = "Income"
  ) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1", name = "Gender")

# Graph with no-topcoded income values will exclude the people with higher income and this will help us have even more accurate data as the topcoded income for 2% level is average and it might interfere in our analysis.
ggplot(no_topcoded_nlsy_df, aes(x = age_1996, y = total_income_2016, color = gender)) +
  geom_jitter(alpha = 0.6, na.rm = TRUE, width = 0.3, height = 0) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Fig2. Income vs Age (1996) by Gender",
    subtitle = "Excluding Topcoded Values",
    x = "Age in 1996",
    y = "Income"
  ) +
  theme_minimal() +
  scale_color_brewer(palette = "Set2", name = "Gender")

# Fig1. illustrates a plot for topcoded income vs age distributed by gender. Red point is for male and blue is for female. It shows income in the range $0-$236K. The age of respondents here is as of 12/31/1996. The graphs shows that the income for male is consistently higher than that for females across different ages 12,13,14,15,16. The trend line indicates that income is approximately $50K for males of age 12 to 14 whereas for females it is around $40K from the age 12 to 15. However, we see that income increased to $60K (approx) for male above the age of 14 and decreased to $35K(approx) for females above the age of 15.
# Fig2. depicts a plot for excluding topcoded income for 2% level. It shows income range in $0-$150K. Green point is for male and orange is for female. Here as the data has topcoded values truncated, the remains similar to the previous one. Male income starts from a little below $50K while females start around $37K which is lower as compared to fig1. The income goes slightly up for males above 14 and income goes down for females above the age of 15.
```

```{r}
ggplot(nlsy_df, aes(x = used_marijuana, y = total_income_2016, fill = gender)) +
  geom_boxplot(alpha = 0.7) +
  labs(
    title = "Income Distribution by Marijuana Use and Gender",
    x = "Used Marijuana",
    y = "Income"
  ) +
  scale_fill_brewer(palette = "Set3", name = "Gender") +
  theme_minimal()
```																					

```{r}
#This is a new chunk by abhishek!Learn Git with Me and surajit
```

##Industry Code vs Income

```{r}
industry_code_nlsy_df <- nlsy_df %>%
  filter(!is.na(industry_code))

industry_code_income_summary <- industry_code_nlsy_df %>%																									
group_by(industry_code) %>%																									
summarize(																									
count = n(),																									
mean_income = mean(total_income_2016, na.rm = TRUE),																									
median_income = median(total_income_2016, na.rm = TRUE),																									
sd_income = sd(total_income_2016, na.rm = TRUE)																									
)																									
print(industry_code_income_summary)																									
```	
The summarized data indicates diverse income statistics across different industry codes. Among the industries, Mining reports the highest mean income of $72,777.78 with a median of $65,000 and relatively high variability (SD = $33,619.29), while Entertainment, Accommodations, and Food Services has the lowest mean income of $36,019 and a median of $30,000. Finance, Insurance, and Real Estate and Active Duty Military also exhibit high mean incomes of $66,745.78 and $67,055.56, respectively. Educational, Health, and Social Services has the largest count of individuals (1,378), showing a moderate mean income of $48,458.78 with notable income spread (SD = $38,455.60). Variability is highest in Finance, Insurance, and Real Estate (SD = $55,332.58), reflecting a broad income range within this sector. Overall, income levels vary significantly across industries, with sectors like Mining and Finance showing higher averages compared to sectors like Entertainment.

```{r}
# Graph with topcoded income values
ggplot(industry_code_nlsy_df, aes(x = industry_code, y = total_income_2016, fill = gender)) +	
  geom_boxplot(na.rm=TRUE)+
  scale_fill_manual(values = c("Male" = "#1f77b4", "Female" = "#ff7f0e")) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Income vs Industry code by Gender",		
       subtitle = "Including Topcoded Values",
    x = "Industry code",																									
    y = "Total Income")	
```	

##Marital Status vs Income

```{r}
marital_status_nlsy_df <- nlsy_df %>%
  filter(!is.na(marital_status))

marital_status_income_summary <- marital_status_nlsy_df %>%																									
group_by(marital_status) %>%																									
summarize(																									
count = n(),																									
mean_income = mean(total_income_2016, na.rm = TRUE),																									
median_income = median(total_income_2016, na.rm = TRUE),																									
sd_income = sd(total_income_2016, na.rm = TRUE)																									
)																									
print(marital_status_income_summary)																									
```	

```{r}
ggplot(marital_status_nlsy_df, aes(x = marital_status, fill = gender)) +
  geom_bar(position = "dodge") +  # Dodged bars for gender comparison
  scale_fill_manual(values = c("Male" = "#1f77b4", "Female" = "#ff7f0e")) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +  # Rotate x-axis labels vertically
  labs(title = "Marital Status by Gender",
       subtitle = "Including Topcoded Values",
       x = "Marital Status",
       y = "Total Income")
```

##Total Number of Incarcerations vs Income

```{r}
total_num_incarcerations_nlsy_df <- nlsy_df %>%
  filter(!is.na(total_num_incarcerations))

total_num_incarcerations_income_summary <- total_num_incarcerations_nlsy_df %>%																									
group_by(total_num_incarcerations) %>%																									
summarize(																									
count = n(),																									
mean_income = mean(total_income_2016, na.rm = TRUE),																									
median_income = median(total_income_2016, na.rm = TRUE),																									
sd_income = sd(total_income_2016, na.rm = TRUE)																									
)																									
print(total_num_incarcerations_income_summary)																									
```	

```{r}

```

```{r}

```

```{r}
#this is my code apurva
```

```{r}
#code by surajit
```

```{r}
#Testing code by abhishek and Apurva
```