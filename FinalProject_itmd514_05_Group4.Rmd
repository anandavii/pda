---
title: "FinalProject_itmd514_05_Group4"
author: "Submitted By: Abhishek Anand, Apurva Anand, Surajit Patra"
date: "2024-12-03"
output:
  html_document:
    toc: true
    toc_depth: 3
---

# INSTALL PACKAGE, LOAD LIBRARIES AND NLSY DATASET

```{r}
# We will require the tidyverse library, ISLR2 library and the dplyr library
# The following loads the library for our use
#install.packages("moments")

library(tidyverse)
library(knitr)
library(ggplot2)
library(gridExtra)
library(moments)

```

```{r}																									
# Import data file for nlsy97
nlsy <- read_csv("nlsy97.csv")
```																									
																									
```{r}																									
# Looking at the data
glimpse(nlsy)
```																									
																									
# PART 1- VARIABLES(SELECTION) AND Exploratory Data Analysis (EDA)

```{r}
# Change column names to meaningful
colnames(nlsy)[colnames(nlsy) == "R0536300"] <- "gender"
colnames(nlsy)[colnames(nlsy) == "R0536402"] <- "birth_year"
colnames(nlsy)[colnames(nlsy) == "R0690800"] <- "is_sad_depressed_unhappy_f"
colnames(nlsy)[colnames(nlsy) == "R1201400"] <- "current_enrollment_status"
colnames(nlsy)[colnames(nlsy) == "U2857200"] <- "total_income_2016"
colnames(nlsy)[colnames(nlsy) == "R1482600"] <- "race"
colnames(nlsy)[colnames(nlsy) == "T6767000"] <- "highest_grade_completed"
colnames(nlsy)[colnames(nlsy) == "R1194000"] <- "age_1996"
colnames(nlsy)[colnames(nlsy) == "R1201300"] <- "citizenship"
colnames(nlsy)[colnames(nlsy) == "R0358900"] <- "used_marijuana"
colnames(nlsy)[colnames(nlsy) == "T7731100"] <- "industry_code"
colnames(nlsy)[colnames(nlsy) == "U1852400"] <- "marital_status"
colnames(nlsy)[colnames(nlsy) == "E8043100"] <- "total_num_incarcerations"
colnames(nlsy)[colnames(nlsy) == "T6650100"] <- "college_type"
colnames(nlsy)[colnames(nlsy) == "S0920700"] <- "trustful_or_not"
```

```{r}
# Creating a df with renamed columns
nlsy_df <- nlsy[, c(
  "gender",
  "birth_year",
  "is_sad_depressed_unhappy_f",
  "current_enrollment_status",
  "total_income_2016",
  "race",
  "highest_grade_completed",
  "age_1996",
  "citizenship",
  "used_marijuana",
  "industry_code",
  "marital_status",
  "total_num_incarcerations",
  "college_type",
  "trustful_or_not"
)]
```

## GENDER	

```{r}																									
# Check the unique values and if any missing values are present
unique(nlsy_df$gender)
table(nlsy_df$gender, useNA = "ifany")
```																									
As we can see here we have a total of 4599 male and 4385 females which are denoted by 1 and 2 factor levels.																									
																									
```{r}																									
# Convert gender to a factor with Male and Female labels
nlsy_df <- nlsy_df %>%
  mutate(gender = factor(gender,
    levels = c(1, 2),
    labels = c("Male", "Female")
  ))
```																									
Renaming the factor level 1 and 2 in the gender column to Male and Female																									
																									
```{r}																									
# Verify the count of Male and Female in the data
nlsy_df %>%
  count(gender, sort = TRUE) %>%
  rename(count = n)
```																									
```{r}																									
# Gender Summary
ggplot(nlsy_df, aes(x = gender, fill = gender)) +
  geom_bar() +
  geom_text(aes(label = ..count..), stat = "count", vjust = 6, size = 6)
labs(title = "Gender Distribution Plot", x = "Gender", y = "Count")
```																									
																									
From the plot above we can see the population distribution contains more number of Male(4599) and less Females(4385).														
	
## BIRTH YEAR

```{r}
# Checking if birth_year column requires cleaning | unique values: 1983 1984 1980 1981 1982
# This variable birth_year does not contain any negative values and hence no cleaning is required for it. We have summarized the variable which tells minimum value expected is 1980, 1st quartile is 1981, median is 1982, 3rd quartile is 1983 and max is 1984.
sort(unique(nlsy_df$birth_year))
summary(nlsy_df$birth_year)
```

```{r}
# This will give us an idea pf count of responses for each type for Birth year.
# The tibble is 5x2 which shows the range of birth year in the survey responses and count of respondants having those birth year, like there are 1874 people having 1981 as the birth year, 1841 people having 1982 as the birth year, 1807 responses for 1983 birth year, 1771 responses for 1984 birth year, and 1691 responses for 1980 birth year.
nlsy_df %>%
  count(birth_year, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting birth year and its concentration
ggplot(data = nlsy_df, aes(x = birth_year, fill = birth_year)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Birth Year of the respondants",
    x = "Birth Year", y = "Count",
  ) +
  scale_fill_brewer(palette = "Set2", name = "birthyear") +
  theme_minimal()
```

## IS SAD DEPRESSED UNHAPPY F

```{r}
# Replace -3, -4, and -5 with NA in the is_sad_depressed_unhappy_f column
# is_sad_depressed_unhappy_f is a primary variable captured in survey year 1997 to see how respondents respond to the question if they are sad, unhappy, or depressed. This variable has 1070 responses for 0 which signifies 'Not true', 472 responses for 1 which signifies 'Sometimes true', and 42 responses for which signifies 'Often true'. Out of total 8984, there are 1584 valid responses and some have negative values like -1(2),-2(2),-4 (7396),-5 which signify refusal, don't know, valid skip, non-interview, respectively. Here we are replacing -3,-4,-5 with NA and then filtering nlsy_df with all NA for this variable. This means that 7400/8984 data is NA which constitutes a huge portion of data and may introduce biases.

nlsy_df <- nlsy_df %>%
  mutate(
    is_sad_depressed_unhappy_f = ifelse(is_sad_depressed_unhappy_f %in% c(-1, -2, -3, -4, -5), NA, is_sad_depressed_unhappy_f)
  )

# Verify the changes
table(nlsy_df$is_sad_depressed_unhappy_f, useNA = "always")

# Omit rows where is_sad_depressed_unhappy_f is NA
# nlsy_df <- nlsy_df %>%
#  filter(!is.na(is_sad_depressed_unhappy_f))
sort(unique(nlsy_df$is_sad_depressed_unhappy_f))

glimpse(nlsy_df)
```

```{r}
# This question 'Is the respondant sad, unhappy, or depressed?' shows a tibble 4x2 where we have marked 0 as Not true, 1 as Sometimes true, 2 as Often true, and for all negative values we have used NA. The table below shows the count of each kind of responses.
nlsy_df <- nlsy_df %>%
  mutate(is_sad_depressed_unhappy_f = case_when(
    is_sad_depressed_unhappy_f == 0 ~ "Not true",
    is_sad_depressed_unhappy_f == 1 ~ "Sometimes true",
    is_sad_depressed_unhappy_f == 2 ~ "Often true",
    is_sad_depressed_unhappy_f < -2 ~ NA_character_
  ))
```

```{r}
# This will give us an idea pf count of responses for each type of responses.
nlsy_df %>%
  count(is_sad_depressed_unhappy_f, sort = TRUE) %>%
  rename(count = n)
```


```{r}
# Omit rows where is_sad_depressed_unhappy_f is NA
Is_Sad_plot_df <- nlsy_df %>%
  filter(!is.na(is_sad_depressed_unhappy_f))
# Plotting is_sad_depressed_unhappy_f and count
ggplot(data = Is_Sad_plot_df, aes(x = is_sad_depressed_unhappy_f, fill = is_sad_depressed_unhappy_f)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "Is the female respondant sad, unhappy, or depressed?",
    x = "Is Sad, Depressed, or Unhappy (Females)", y = "Count",
  ) +
  scale_fill_brewer(palette = "Set2", name = "Type of Responses") +
  theme_minimal()
```

## ENROLLMENT STATUS	

```{r}																									
# Check for unique values and if any missing values are present
unique(nlsy_df$current_enrollment_status)
table(nlsy_df$current_enrollment_status, useNA = "ifany")
```																									
There exist 2 values indicating Don't Know, denoted by -2																									
																									
```{r}																									
# Changing factor levels for current_enrollment_status into labels
nlsy_df <- nlsy_df %>%
  mutate(current_enrollment_status = case_when(
    current_enrollment_status == 1 ~ "Not enrolled, no high school degree, no GED",
    current_enrollment_status == 2 ~ "Not enrolled, GED",
    current_enrollment_status == 3 ~ "Not enrolled, high school degree",
    current_enrollment_status == 4 ~ "Not enrolled, some college",
    current_enrollment_status == 5 ~ "Not enrolled, 2-year college graduate",
    current_enrollment_status == 6 ~ "Not enrolled, 4-year college graduate",
    current_enrollment_status == 7 ~ "Not enrolled, graduate degree",
    current_enrollment_status == 8 ~ "Enrolled in grades 1-12, not a high school graduate",
    current_enrollment_status == 9 ~ "Enrolled in a 2-year college",
    current_enrollment_status == 10 ~ "Enrolled in a 4-year college",
    current_enrollment_status == 11 ~ "Enrolled in a graduate program",
    current_enrollment_status < 0 ~ NA_character_
  ))
```																									
In the above we have lebelled the enrollment statuses and also changed the negative  values with NA the count of which is only 2 rows which is 2/8984 rows and ~0.02% of total data.																									
																									
```{r}																									
# Verify the count of different enrollment statuses
nlsy_df %>%
  count(current_enrollment_status, sort = TRUE) %>%
  rename(count = n)
```																									
From the table above we observe that 8742 of the respondants said that their current enrollment status is "Enrolled in grades 1-12, not a high school graduate" and this is followed by the ones who responsded "Not enrolled, no high school degree, no GED	" which is 226.

```{r}
# Create the plot with proper count calculation
ggplot(nlsy_df, aes(x = reorder(current_enrollment_status, -table(current_enrollment_status)[current_enrollment_status]), fill = current_enrollment_status)) +
  geom_bar(stat = "count", show.legend = FALSE) +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 1.2) +
  labs(title = "Distribution of current enrollment status", x = "Current Enrollment Status", y = "Count") +
  theme(axis.text.x = element_text(angle = 80, vjust = 1, hjust = 1))
```
From the bar plot above we observe that 8742 of the respondents confirmed their current enrollment status is "Enrolled in grades 1-12, not a high school graduate" and this is followed by the ones who responded "Not enrolled, no high school degree, no GED	" which is 226.

## TOTAL INCOME 2016

```{r} 
# Check the data
unique(nlsy_df$total_income_2016)
```

```{r}
# Handle negative values and replace with NA
nlsy_df <- nlsy_df %>%
  mutate(total_income_2016 = ifelse(total_income_2016 < 0, NA, total_income_2016))
```

```{r}
# Summarize the total_income_2016 column
summary(nlsy_df$total_income_2016)

# Count the number of missing values
sum(is.na(nlsy_df$total_income_2016))

# Calculate the percentage of missing values
sum(is.na(nlsy_df$total_income_2016)) / nrow(nlsy_df) * 100
```

From the above we can see that the missing values(NA) are 3893 which is 43.33% of the total data which might lead to bias. The mean is 49447 which is likely lower than the expected value due to the topcoding for the top 2%. The maximum income is 235884 which is also not the actual highest income but represents the average of the topcoded values. The median income is $40,000, and the interquartile range (IQR) spans from $25,000 to $62,000.


```{r}
# Number of Topcoded values(repondents with higher income)
topcoded <- with(nlsy_df, sum(total_income_2016 == max(total_income_2016, na.rm = TRUE), na.rm = TRUE))
topcoded
```   

There are 121 topcoded values present with the income of $235,884. These 121 respondants are among the top 2% of the earners and are given an average value of $235,884

```{r}
# Summarize the total_income_2016 column excluding topcoded values and removing NA rows
nlsy_no_topcoded <- nlsy_df %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))
summary(nlsy_no_topcoded$total_income_2016)
```

We have removed the respondents response who were hiding info or their responses could not be captured for their income in 2016.
After removing the topcoded values it lowers the mean income from $49,477 to $44,939. The maximum income also drops from $235,884 to $149,000, which is the actual cutoff for the topcoded group. The median and IQR remain largely unchanged, showing that the central distribution of income is not significantly affected by the exclusion of topcoded values.


```{r}
# Visualizing income distribution histogram including the topcoded values
plot1 <- ggplot(nlsy_df, aes(x = total_income_2016)) +
  geom_histogram(bins = 30, fill = "purple", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig1. Total Income 2016",
    subtitle = "Including Topcoded values",
    x = "Total Income for 2016",
    y = "Frequency on income"
  )

# Visualizing income distribution boxplot  including the topcoded values
plot2 <- ggplot(nlsy_df, aes(y = total_income_2016)) +
  geom_boxplot(fill = "cyan", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig1.1 Total Income 2016",
    subtitle = "Including Topcoded values",
    y = "Total Income"
  )

# Visualizing income distribution histogram excluding the topcoded values
nlsy_no_topcoded <- nlsy_df %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))

plot3 <- ggplot(nlsy_no_topcoded, aes(x = total_income_2016)) +
  geom_histogram(bins = 30, fill = "purple", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig2. Total Income 2016",
    subtitle = "Excluding Topcoded values",
    x = "Total Income for 2016",
    y = "Frequency on income"
  )

# Visualizing income distribution boxplot excluding the topcoded values
plot4 <- ggplot(nlsy_no_topcoded, aes(y = total_income_2016)) +
  geom_boxplot(fill = "cyan", color = "black", na.rm = TRUE) +
  labs(
    title = "Fig2.1 Total Income 2016",
    subtitle = "Excluding Topcoded values",
    y = "Total Income"
  )

grid.arrange(plot1, plot2, plot3, plot4, ncol = 2)
```   

In the above we see that the income is topcoded and the value for the top 2% earners is replaced with average income of this group. In Fig1. the histogram is right skewed which means that there are very few high income earners but most earners make less and this skewness shows that the majority of the population earns much less than this topcoded value.

In Fig1.1 the boxplot for the same data shows that the median income is around $40,000, and the Interquartile Range (IQR) spans from $25,000 to $62,000. This means that 50% of the individuals' incomes fall within this range. The plot also identifies the topcoded value as an outlier at $235,884, which is far outside the typical income range. 

In Fig 2.when the topcoded values are removed, the histogram shows a more accurate representation of the income distribution, with the right skew still present but less extreme. This plot offers a more realistic view of the income structure, showing that the vast majority of individuals earn significantly less than $235,884.

Similarly in Fig2.1 the boxplot, now excluding the topcoded values, shows a median income of $35,000 and a more concentrated IQR of $25,000 to $50,000. By removing the topcoded value, the outlier is eliminated, and the distribution is more representative of the actual income spread. This boxplot highlights the more typical income range for most individuals, without the distortion introduced by the topcoded values.
	
## RACE			

```{r}																									
# Check for unique values and if any missing values are present
unique(nlsy_df$race)
table(nlsy_df$race, useNA = "ifany")
```																									
Here we can see that we have the valid values from 1-4 and this column does not contain any missing values as well. Now further we can encode the numeric values to the race/ethinicity.																									
																									
```{r}																									
# Recode race values into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(race = case_when(
    race == 1 ~ "Black",
    race == 2 ~ "Hispanic",
    race %in% c(3, 4) ~ "Other" # Combine "Mixed Race" and "Non-Black" into "Other"
  )) %>%
  mutate(race = factor(race, levels = c("Black", "Hispanic", "Other")))
```																									
																									
```{r}																									
# Count the number of respondents in each race group
nlsy_df %>%
  count(race, sort = TRUE) %>%
  rename(count = n)
```																									
From the count we can infer that the total population contains 2335 Black respondents, 1901 Hispanic, 4665 Non-Black and 83 Mixed Race in Others population.																									
																									
```{r}																									
# Race Summary
ggplot(nlsy_df, aes(x = reorder(race, -table(race)[race]), fill = race)) +
  geom_bar() +
  geom_text(aes(label = ..count..), stat = "count", vjust = 6, size = 6) +
  labs(
    title = "Race Distribution Plot", x = "Race", y = "Count",
    subtitle = "Note: 'Other' includes Mixed Race and Non-Black"
  )
```																									

## HIGHEST GRADE COMPLETED

```{r}
# Check for unique values and if any missing values are present
unique(nlsy_df$highest_grade_completed)
table(nlsy_df$highest_grade_completed, useNA = "ifany")
```
From the above we can see there are four types of negative values present which are -5, -4, -2 and -1 denoting non-interview, skipped, don't know and refusal. Further we have to encode the values with appropiriate labels.

```{r}
# Replace negative values with NA
nlsy_df <- nlsy_df %>%
  mutate(highest_grade_completed = ifelse(highest_grade_completed < 0, NA, highest_grade_completed))
```

```{r}
# Recode highest grade completed into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(highest_grade_completed = case_when(
    highest_grade_completed == 0 ~ "None",
    highest_grade_completed == 1 ~ "1st Grade",
    highest_grade_completed == 2 ~ "2nd Grade",
    highest_grade_completed == 3 ~ "3rd Grade",
    highest_grade_completed == 4 ~ "4th Grade",
    highest_grade_completed == 5 ~ "5th Grade",
    highest_grade_completed == 6 ~ "6th Grade",
    highest_grade_completed == 7 ~ "7th Grade",
    highest_grade_completed == 8 ~ "8th Grade",
    highest_grade_completed == 9 ~ "9th Grade",
    highest_grade_completed == 10 ~ "10th Grade",
    highest_grade_completed == 11 ~ "11th Grade",
    highest_grade_completed == 12 ~ "12th Grade",
    highest_grade_completed == 13 ~ "1st Year College",
    highest_grade_completed == 14 ~ "2nd Year College",
    highest_grade_completed == 15 ~ "3rd Year College",
    highest_grade_completed == 16 ~ "4th Year College",
    highest_grade_completed == 17 ~ "5th Year College",
    highest_grade_completed == 18 ~ "6th Year College",
    highest_grade_completed == 19 ~ "7th Year College",
    highest_grade_completed == 20 ~ "8th Year College or More",
    highest_grade_completed == 95 ~ "Ungraded",
    highest_grade_completed < 0 ~ NA_character_
  ))
```

```{r}
# Verify the count of different grades
nlsy_df %>%
  count(highest_grade_completed, sort = TRUE) %>%
  rename(count = n)
```
From above we see that majority of the population did not answer about their grades which is 7436. From the remaining we can see that the majority of population completed 2nd year college(277) followed by 1st year college(213).

```{r}
# Create the plot with proper count calculation
ggplot(nlsy_df, aes(x = reorder(highest_grade_completed, table(highest_grade_completed)[highest_grade_completed]), fill = highest_grade_completed)) +
  geom_bar(stat = "count", show.legend = FALSE) +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5, size = 3) +
  labs(title = "Distribution of Highest Grade Completed", x = "Highest Grade Completed", y = "Count") +
  theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
```
From the above we see that theere are missing values for the majority of responses which is 7436. From the remaining we can see that the majority of population completed 2nd year college(277) followed by 1st year college(213).

## AGE AS OF 1996 DECEMBER 31ST

```{r}
# Checking if Age as of 1996 december 31st needs cleaning | unique values: 13 12 16 15 14
# The variable Age shows the minimum expected value in survey response is 12, 1st quartile is 13, median is 14, mean is 13.99, 3rd quartile is 15, and max is 16. This variable does not have any missing values and hence no cleaning is required.
unique(nlsy_df$age_1996)
summary(nlsy_df$age_1996)
```


```{r}
# The tabular form of data displayed below shows the age and number of people having that age.
nlsy_df %>%
  count(age_1996, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting age and its concentration
ggplot(data = nlsy_df, aes(x = age_1996, fill = age_1996)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Age of the respondants as of 21/31/1996",
    x = "Age (as of 12/31/1996)", y = "Count",
  ) +
  theme_minimal()
```
	
## CITIZENSHIP

```{r}
# Checking if Citizenship requires cleaning | unique values:  1 3 2 -4
# Citizenship is a variable have 1,2,3 as response in the survey and -4, a negative value indicating Valid Skip. We will be cleaning this variable to replace -4 in the data with NA. Furthermore, summarizing this variable we get min value as -4 ( which will be treated later), 1st quartile is 1, median is 1, mean is 0.6279, 3rd quartile is 1, and max is 3.
unique(nlsy_df$citizenship)
summary(nlsy_df$citizenship)
```

```{r}
# The tabular form of data displayed below shows the age and number of people having that age.
# Here we see that there is a significant number of responses with negative value in our data set for Citizenship variable. If we change -4 to NA, then 1042 data will be omitted when we plot it which might introduce biases in the data and the output might not be accurate.
nlsy_df %>%
  count(citizenship, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Replace -4 with NA in the Citizenship column
nlsy_df <- nlsy_df %>%
  mutate(
    citizenship = ifelse(citizenship %in% c(-4), NA, citizenship)
  )

# Verify the changes
table(nlsy_df$citizenship, useNA = "always")
```


```{r}
# For this question 'What is the citizenship', we have marked 1 as Citizen, born in the U.S., 2 as Unknown, not born in U.S., 3 as Unknown, not born in U.S., and for all negative values we have used NA. The table below shows the count of each kind of responses.
nlsy_df <- nlsy_df %>%
  mutate(citizenship = case_when(
    citizenship == 1 ~ "Citizen",
    citizenship == 2 ~ "Birthplace Unknown",
    citizenship == 3 ~ "Non-Citizen",
    citizenship < 1 ~ NA_character_
  ))
```

```{r}
# Upon mutating values for citizenship to make it categorical we have replaced -4 with NA for 1042 rows, 1 with Citizen, born in the U.S., 2 with Unknown, not born in U.S., 3 with Unknown, can't determine birthplace, and anything less than 1 with NA. This helps us in easily reading the analysis.
nlsy_df %>%
  count(citizenship, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting citizenship and its concentration
ggplot(data = nlsy_df, aes(x = citizenship, fill = citizenship)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Citizenship of the respondant",
    x = "Citizenship", y = "Count",
  ) +
  theme_minimal()
# The graph below shows how the response is ranged across. It illustrates that majority of the respondants have a citizenship of the U.S. and constitutes to 6869 out of 8984, some don't know their birthplace constitute to 794, some who were not born in the U.S. adds up to 279, and the remaining 1042 were all missing data. This, we can say that 76.45% of the people were born in the U.S., 3.1% were not born in the U.S, 8.83% cannot determine their birthplace, and 11.5% of significant population skipped the question.
```

## EVER USE MARIJUANA

```{r}
# This variable Citizenship has different values like Non-Citizen, Birthplace Unknown, Citizen , and NA. Possible responses are 0,1,-1,-2,-3 where 0 indicates No, 1 indicates Yes, -1 indicates Refusal, -2 indicates Don't know, and -3 indicates Invalid Skip. To clean this we will be taking -1 and -2 into consideration as it can tell us if respondents might be hiding the truth. However, we can replace -3 with NA to get the accurate analysis done for this variable.
unique(nlsy_df$used_marijuana)
summary(nlsy_df$used_marijuana)
```

```{r}
# To clean the variable Used Marijuana, we are performing following steps like converting to categorical values for ease of analysis.
# Replace -3 with NA in the Used_Marijuana
nlsy_df <- nlsy_df %>%
  mutate(
    used_marijuana = ifelse(used_marijuana %in% c(-3), NA, used_marijuana)
  )

# Verify the changes
table(nlsy_df$used_marijuana, useNA = "always")
```

```{r}
# Here we have different factor levels like Don't know, Refusal, No, Yes for Factor used_marijuana.
nlsy_df <- nlsy_df %>%
  mutate(used_marijuana = factor(used_marijuana, levels = c(-2, -1, 0, 1), labels = c("Don't Know", "Refusal", "No", "Yes")))
```

```{r}
# Upon factoring values for used_marihjuana to make it categorical we have replaced -3 with NA for 2 rows, 1 with Yes, 0 with No, -1 with Refusal, and -2 with don't know. This helps us in easily reading the analysis.
nlsy_df %>%
  count(used_marijuana, sort = TRUE) %>%
  rename(count = n)
```

```{r}
# Plotting used_marijuana
ggplot(data = nlsy_df, aes(x = reorder(used_marijuana, -table(used_marijuana)[used_marijuana]), fill = used_marijuana)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "Have you ever used marijuana?",
    x = "Used Marijuana", y = "Count",
  ) +
  scale_fill_brewer(palette = "Set3", name = "Type of Responses") +
  theme_minimal()
# The graph below illustrates that 79.56% (7148) of respondents do not use marijuana, 19.97% (1795) use marijuana, 0.05% (5) don't know if the used it, 0.37% (34) refused to answer the question, and the question was a invalid skip for 2 people. By this plot, we can say that 0.43% (39) people might be hiding some information on use of marijuana. There is a significant number of respondents who use marijuana.
```

## INDUSTRY CODE  

```{r}                                                  
# Checking unique values in industry_code
unique(nlsy_df$industry_code)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$industry_code, useNA = "ifany")
```                                                 
                                                  
From the above, we observe:                                                 
                                                  
1561 values are NON-INTERVIEW (denoted by -5),                                                  
1128 values are VALID SKIP (denoted by -4),                                                 
129 values are Invalid Skip (denoted by -3).                                                  
                                                  
```{r}                                                  
# Recoding industry_code with descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(industry_code = case_when(
    industry_code >= 170 & industry_code <= 290 ~ "Agriculture, Forestry, and Fisheries",
    industry_code >= 370 & industry_code <= 490 ~ "Mining",
    industry_code >= 570 & industry_code <= 690 ~ "Utilities",
    industry_code == 770 ~ "Construction",
    industry_code >= 1070 & industry_code <= 3990 ~ "Manufacturing",
    industry_code >= 4070 & industry_code <= 4590 ~ "Wholesale Trade",
    industry_code >= 4670 & industry_code <= 5790 ~ "Retail Trade",
    industry_code == 5890 ~ "Arts, Entertainment, and Recreation Services",
    industry_code >= 6070 & industry_code <= 6390 ~ "Transportation and Warehousing",
    industry_code >= 6470 & industry_code <= 6780 ~ "Information and Communication",
    industry_code >= 6870 & industry_code <= 7190 ~ "Finance, Insurance, and Real Estate",
    industry_code >= 7270 & industry_code <= 7790 ~ "Professional and Related Services",
    industry_code >= 7860 & industry_code <= 8470 ~ "Educational, Health, and Social Services",
    industry_code >= 8560 & industry_code <= 8690 ~ "Entertainment, Accommodations, and Food Services",
    industry_code >= 8770 & industry_code <= 9290 ~ "Other Services",
    industry_code >= 9370 & industry_code <= 9590 ~ "Public Administration",
    industry_code >= 9670 & industry_code <= 9890 ~ "Active Duty Military",
    industry_code >= 9950 & industry_code <= 9990 ~ "ACS Special Codes",
    industry_code < 0 ~ NA_character_ # Handling special codes (-5, -4, -3)
  ))
```                                                 
                                                  
In the above we have lebelled the industry code and also changed the negative values with NA.                                                 
                                                  
```{r}                                                  
# Counting missing values
sum(is.na(nlsy_df$industry_code))
```                                                 
                                                  
The count of missing values is 1561+1128+129 = 2818 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$industry_code)) / nrow(nlsy_df) * 100
```                                                 
From the above we can see that the missing values(NA) are 2818 and the percentage can be calculated as 2818/8984*100 which is 31.37% of the total data which causes the data to be baised.                                                  
                                                  
```{r}                                                  
# Verifying the count of each industry_code
nlsy_df %>%
  count(industry_code, sort = TRUE) %>%
  rename(count = n)
``` 

```{r}
# Visualizing industry code distribution with a bar plot
ggplot(data = nlsy_df, aes(x = industry_code)) +
  geom_bar(fill = "pink", color = "black") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "Industry Code Distribution",
    x = "Industry Code Types",
    y = "Count"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```
                                                  
The industry_code variable shows that 2818 rows are missing, accounting for 31.38% of the dataset. The largest group belongs to Educational, Health, and Social Services (1378 respondents), followed by Professional and Related Services (813) and Entertainment, Accommodations, and Food Services (718). Smaller industries, like Utilities (38) and Active Duty Military (22), are least represented. The missing data introduces potential bias and should be accounted for in analysis.                                                  
                                                  
## MARITAL STATUS

```{r}                                                  
# Checking unique values
unique(nlsy_df$marital_status)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$marital_status, useNA = "ifany")
```                                                 
                                                  
There exists 2250 values indicating NON-INTERVIEW denoted by -5 and 62 values indicating Invalid Skip denoted by -3.                                                  
                                                  
```{r}                                                  
# Recode marital_status values into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(marital_status = case_when(
    marital_status == 0 ~ "Never-married",
    marital_status == 1 ~ "Married",
    marital_status %in% c(2, 3, 4) ~ "Other" # Combine "Separated", "Divorced", "Widowed"
  )) %>%
  mutate(marital_status = factor(marital_status, levels = c("Never-married", "Married", "Other")))
```                                                 
                                                  
In the above we have lebelled the marital status and also changed the negative values with NA.                                                  
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$marital_status))
```                                                 
The count of missing values is 2250+62 = 2312 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$marital_status)) / nrow(nlsy_df) * 100
```                                                 
From the above we can see that the missing values(NA) are 2312 and the percentage can be calculated as 2312/8984*100 i.e. 25.73% of the total data which causes the data to be baised.                                                  
```{r}                                                  
# Verifying the count of each marital_status
nlsy_df %>%
  count(marital_status, sort = TRUE) %>%
  rename(count = n)
```  


```{r}                                                  
# Visualizing marital status distribution with a bar plot
ggplot(data = nlsy_df, aes(x = marital_status, fill = marital_status)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "What is the Marital Status?",
    x = "Marital Status",
    y = "Count",
    subtitle = "Note: 'Other' includes Separated, Divorced and Widowed"
  ) +
  theme_minimal()
```                                                 
  
The marital_status distribution shows that the majority of respondents are Never-married (2766) or Married (3066). Smaller numbers are classified as "Other" (e.g., Separated, Divorced, Widowed). About 25.75% of the data is missing, which may introduce bias.                                                 
In the bar plot above, we can see that a significant portion of the dataset is missing marital status information, with about 25.75% of respondents not providing data due to non-interviews (-5) and invalid skips (-3). This missing data introduces potential bias in any analysis of marital status and should be carefully addressed. The largest groups in the marital status distribution are "Never-married" (2766 respondents) and "Married" (3066 respondents), with smaller numbers for "Divorced" (663), "Separated" (154), and "Widowed" (23). The distribution is relatively skewed towards those who are "Never-married" or "Married," while the other categories are underrepresented. The presence of missing data in a large proportion of respondents calls for caution, as it may affect the generalizability of any findings related to marital status in this sample.                                                 

## TOTAL NUM INCARCERATION

```{r}                                                  
# Checking unique values in total_num_incarcerations
unique(nlsy_df$total_num_incarcerations)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$total_num_incarcerations, useNA = "ifany")
```                                                 
                                                  
From the data, 21 rows are Invalid Skip (denoted by -3).                                                  
                                                  
```{r}                                                  
# Recoding total_num_incarcerations into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(total_num_incarcerations = case_when(
    total_num_incarcerations == 0 ~ "No incarcerations",
    total_num_incarcerations >= 1 & total_num_incarcerations <= 2 ~ "1 to 2 incarcerations",
    total_num_incarcerations >= 3 & total_num_incarcerations <= 4 ~ "3 to 4 incarcerations",
    total_num_incarcerations >= 5 & total_num_incarcerations <= 6 ~ "5 to 6 incarcerations",
    total_num_incarcerations >= 7 & total_num_incarcerations <= 8 ~ "7 to 8 incarcerations",
    total_num_incarcerations >= 9 & total_num_incarcerations <= 10 ~ "9 to 10 incarcerations",
    total_num_incarcerations >= 11 & total_num_incarcerations <= 12 ~ "11 to 12 incarcerations",
    total_num_incarcerations >= 13 & total_num_incarcerations <= 14 ~ "13 to 14 incarcerations",
    total_num_incarcerations >= 15 & total_num_incarcerations <= 16 ~ "15 to 16 incarcerations",
    total_num_incarcerations >= 17 & total_num_incarcerations <= 18 ~ "17 to 18 incarcerations",
    total_num_incarcerations >= 19 & total_num_incarcerations <= 20 ~ "19 to 20 incarcerations",
    total_num_incarcerations < 0 ~ NA_character_ # Handling special codes (-1, -2, -3)
  ))
```                                                 
                                                  
In the above we have lebelled the total_num_incarcerations and also changed the negative values with NA.                                                  
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$total_num_incarcerations))
```                                                 
                                                  
The count of missing values is 21 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$total_num_incarcerations)) / nrow(nlsy_df) * 100
```                                                 
                                                  
From the above we can see that the missing values(NA) are 21 and the percentage can be calculated as 21/8984*100 i.e. 0.23% of the total data.                                                  
                                                  
```{r}                                                  
# Verifying the count of total_num_incarcerations for different levels
nlsy_df %>%
  count(total_num_incarcerations, sort = TRUE) %>%
  rename(count = n)
```

```{r}                                                  
# Bar plot for total_num_incarcerations
ggplot(data = nlsy_df, aes(x = total_num_incarcerations)) +
  geom_bar(fill = "lightgreen", color = "black") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.4) +
  labs(
    title = "Total number of Incarcerations",
    x = "Number of Incarcerations",
    y = "Count"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0.8))
```  
                                                  
The distribution of total_num_incarcerations reveals that the majority of respondents (8054) reported "No incarcerations", indicating no contact with the criminal justice system. Smaller groups reported 1 to 2 incarcerations (716 respondents) and 3 to 4 incarcerations (146 respondents). Only 38 respondents reported 5 to 6 incarcerations, and even fewer experienced higher levels of incarceration: 7 respondents for 7 to 8 incarcerations, 1 respondent for 9 to 10 incarcerations, and 1 respondent for 11 to 12 incarcerations. With only 21 missing values (0.23%), the data is relatively complete for this variable.                                                  

## COLLEGE TYPE

```{r}                                                  
# Checking unique values in college_type
unique(nlsy_df$college_type)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$college_type, useNA = "ifany")
```                                                 
                                                  
From the data:                                                  
                                                  
1561 rows are NON-INTERVIEW (denoted by -5),                                                  
5937 rows are VALID SKIP (denoted by -4),                                                 
52 rows are Invalid Skip (denoted by -3).                                                 
                                                  
```{r}                                                  
# Changing factor levels for college_type into labels
nlsy_df <- nlsy_df %>%
  mutate(college_type = case_when(
    college_type == 1 ~ "Public institution",
    college_type == 2 ~ "Private not-for-profit institution",
    college_type == 3 ~ "Private for-profit institution",
    college_type < 0 ~ NA_character_ # Handling special codes (-1, -2, -3, -4, -5)
  ))
```                                                 
                                                  
In the above we have lebelled the college types and also changed the negative values with NA.                                                 
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$college_type))
```                                                 
                                                  
The count of missing values is 1561+5937+52 = 7550 rows.                                                  
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$college_type)) / nrow(nlsy_df) * 100
```                                                 
                                                  
From the above we can see that the missing values(NA) are 7550 and the percentage given by 7550/8984*100 i.e. 84.04% of the total data which causes the data to be baised.

```{r}                                                  
# Verifying the count of each college_type
nlsy_df %>%
  count(college_type, sort = TRUE) %>%
  rename(count = n)
```  
                                                  
```{r}                                                  
# Bar plot for college_type
ggplot(data = nlsy_df, aes(x = college_type)) +
  geom_bar(fill = "orange", color = "black") +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.2) +
  labs(
    title = "College Type Distribution",
    x = "College Type",
    y = "Count"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```                                                 

The college_type variable indicates the type of institution respondents attended. The majority of respondents (960) attended a Public institution, followed by 261 respondents who attended a Private for-profit institution, and 213 respondents who attended a Private not-for-profit institution. A significant portion of the data (7550 rows, approximately 84.04%) is missing or marked as NA due to NON-INTERVIEW, VALID SKIP, or Invalid Skip. This high proportion of missing data introduces potential bias and limits the generalizability of findings. The distribution suggests that public institutions dominate the sample, with relatively few respondents attending private institutions of either type.            

## TRUSTFUL OR NOT
```{r}                                                  
# Checking the data for unique values
unique(nlsy_df$trustful_or_not)
```                                                 
                                                  
```{r}                                                  
table(nlsy_df$trustful_or_not, useNA = "ifany")
```                                                 
                                                  
It can be seen that 1088 values are NON-INTERVIEW denoted by -5, 3005 values are VALID SKIP denoted by -4, 3 values are Don't Know denoted by -2 and 13 values are Refusal denoted by -1.                                                 
                                                  
```{r}                                                  
# Recode trustful_or_not values into descriptive labels
nlsy_df <- nlsy_df %>%
  mutate(trustful_or_not = case_when(
    trustful_or_not >= 1 & trustful_or_not <= 3 ~ "Distrustful",
    trustful_or_not >= 4 ~ "Trustful",
    trustful_or_not < 0 ~ NA_character_ # Handling special codes (-1, -2, -3, -4, -5)
  )) %>%
  mutate(trustful_or_not = factor(trustful_or_not, levels = c("Distrustful", "Trustful")))
```                                                 
                                                  
In the above we have lebelled the college types and also changed the negative values with NA.                                                 
                                                  
```{r}                                                  
# Counting the number of missing values
sum(is.na(nlsy_df$trustful_or_not))
```                                                 
                                                  
The count of missing values is 4109 rows.                                                 
                                                  
```{r}                                                  
# Calculating the percentage of missing values
sum(is.na(nlsy_df$trustful_or_not)) / nrow(nlsy_df) * 100
```                                                 
                                                  
From the above we can see that the missing values(NA) are 4109 and the percentage given by 4109/8984*100 i.e. 45.73% of the total data which causes the data to be baised.                                                  

```{r}                                                  
# Verifying the count of each trustful_or_not
nlsy_df %>%
  count(trustful_or_not, sort = TRUE) %>%
  rename(count = n)
```  
                                                  
```{r}                                                  
# Bar plot for trustful_or_not
ggplot(data = nlsy_df, aes(x = trustful_or_not, fill = trustful_or_not)) +
  geom_bar() +
  geom_text(stat = "count", aes(label = ..count..), vjust = -0.5) +
  labs(
    title = "IS Trustful or Distrustful",
    x = "Trustfulness",
    y = "Count"
  ) +
  theme_minimal()
```                                                 
                                                  
The trustful_or_not variable shows a high percentage of missing data (45.73%). Among the valid data, the "Trustful" group (values >= 4) has a higher count than the "Distrustful" group (values 1–3). The missing data should be carefully addressed to ensure reliable insights.

# PART 2 - RELATIONSHIP AND TREND ANALYSIS

## INCOME vs GENDER

```{r}
# Summarize income by gender including topcoded variable, excluding NA

gender_income_summary <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>% # Exclude rows with NA in income
  group_by(gender) %>%
  summarize(
    count = n(),
    mean_income = round(mean(total_income_2016, na.rm = TRUE)),
    median_income = round(median(total_income_2016, na.rm = TRUE)),
    sd_income = round(sd(total_income_2016, na.rm = TRUE))
  )
print(gender_income_summary)

# Summarize income by gender excluding topcoded variable, excluding NA

# Excuding the top coded values
nlsy_no_topcoded <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))

gender_income_summary <- nlsy_no_topcoded %>%
  group_by(gender) %>%
  summarize(
    count = n(), # Count rows after filtering
    mean_income = round(mean(total_income_2016, na.rm = TRUE)),
    median_income = round(median(total_income_2016, na.rm = TRUE)),
    sd_income = round(sd(total_income_2016, na.rm = TRUE))
  )
print(gender_income_summary)
```

The above tabular summary for income by gender shows that males have a higher average income ($57,203) compared to females ($41,279), with a median income of $47,000 for males and $35,000 for females. The standard deviation is also higher for males ($44,712) than for females ($34,047), indicating greater income variability among males. Overall, males consistently earn more on average and have more variation in income compared to females.

```{r}
plot1 <- ggplot(nlsy_df, aes(x = gender, y = total_income_2016, fill = gender)) +
  geom_boxplot(show.legend = FALSE, na.rm = TRUE) +
  labs(
    title = "Fig1.Income Distribution by Gender",
    subtitle = "Including Topcoded values",
    x = "Gender",
    y = "Total Income"
  )

# Plot of Income with Gender excluding topcoded values
nlsy_no_topcoded <- nlsy_df %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))

plot2 <- ggplot(nlsy_no_topcoded, aes(x = gender, y = total_income_2016, fill = gender)) +
  geom_boxplot(show.legend = FALSE) +
  labs(
    title = "Fig2.Income Distribution by Gender",
    subtitle = "Excluding Topcoded values",
    x = "Gender",
    y = "Total Income"
  )

grid.arrange(plot1, plot2, ncol = 2)
```

The box plot shows the distribution of income by gender, highlighting key differences between males and females. Males have a higher median income (indicated by the middle line of the box) compared to females. The overall spread of income is wider for males, as shown by the larger interquartile range and longer whiskers, reflecting greater income variability. From this boxplot we can say that males tend to earn more and have more income variability compared to females.

## INCOME vs RACE

```{r}
# Calculate mean income by race and gender, excluding rows with NA in income
income_by_race_gender <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>% # Exclude rows where income is NA
  group_by(race, gender) %>%
  summarize(
    average_income = round(mean(total_income_2016, na.rm = TRUE)), # Calculate mean income
    count = n() # Count rows after filtering
  )
# Display the tabular summary
income_by_race_gender
```

From the above we can see that the average income and the number of individuals for each race-gender combination, highlighting clear disparities. Males consistently earn more than females across all racial groups, with the income gap being the largest in the "Other" group ($18,279 difference) and smallest in the "Black" group ($6,873 difference). Among racial groups, individuals in the "Other" category have the highest average income for both males ($64,519) and females ($46,240), followed by "Hispanic" and "Black" groups, where males earn $53,326 and $42,110, respectively. Within each race, males and females are nearly equally represented, though males slightly outnumber females in most cases. This data reveals significant income disparities by both race and gender.

```{r}
# Create the bar plot for income by race and gender including topcoded values
ggplot(nlsy_df, aes(x = race, y = total_income_2016, fill = gender)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge", show.legend = TRUE, na.rm = TRUE) +
  geom_text(
    aes(label = round(..y..)),
    stat = "summary", fun = "mean", position = position_dodge(width = 0.9), vjust = 6, size = 4
  ) +
  labs(
    title = "Income by Race and Gender",
    subtitle = "Including Topcoded values",
    x = "Race",
    y = "Average Income",
    fill = "Gender"
  )
```
The bar plot shows the average income by race and gender, with distinct bars for males and females within each racial group. The "Other" group has the highest average income for both males ($64,519) and females ($46,240), followed by "Hispanic" and "Black" groups. Males consistently earn more than females across all groups, with the gender gap largest in the "Other" group ($18,279) and smallest in the "Black" group ($6,873). The plot highlights significant income disparities both between races and genders.

## CITIZENSHIP vs INCOME

```{r}																									
# Summarize income by citizenship status by gender distribution
# The table below shows the count of respondents for different category of citizenship, mean_income, median_income, and standard deviation. Here we can see that the mean income for citizen is less than the non-citizen and people who don't know their birthplace have the highest mean income. However, the median income for non-citizen is the highest.Also, standard deviation for citizens is lowest compared to non-citizen and unknown birthplace category respondents. The NA consists of valid skip which means the question was not applicable to those respondants and hence we have omitted it. Therefore, the data we see for citizenship status in table or the graph will be for the 7942 responses as out of 8984 we omitted 1042 rows. Also, the male and female distribution is shown for income based on citizenship.

# Omit rows where Citizenship is NA
citizen_nlsy_df <- nlsy_df %>%
  filter(!is.na(citizenship))

citizenship_income_summary <- citizen_nlsy_df %>%
  group_by(citizenship) %>%
  summarize(
    count = n(),
    count_male = sum(gender == "Male", na.rm = TRUE),
    count_female = sum(gender == "Female", na.rm = TRUE),
    mean_income = mean(total_income_2016, na.rm = TRUE),
    median_income = median(total_income_2016, na.rm = TRUE),
    sd_income = sd(total_income_2016, na.rm = TRUE)
  )
print(citizenship_income_summary)
```		

```{r}																									
# Analyzing income with citizenship based on Gender. Here, citizenship is categorical variable. The graph shows a range from $0-$200,000. The pink box represent male and turquoise boxes represent females. Each box plot shows median, quantiles, and outliers. The graphs show population into four groups called birthplace unknown, citizen, and non-citizen. Males show high median incomes across all citizenship categories as compared to females in turquoise boxes. The median income for males is around $50K, while for females it is lower around $35K. We can also say that the 1st quartile for females lies even below the 25K mark, while for males, the 1st quantile is above the 30K mark. The outliers show dots above the whiskers reaching up to $235K. We can also say that the 1st quantile for female lies even below 25K mark while for male 1st quantile is above 30K mark. We can say that the income disparity between genders appear to be relatively consistent across different citizenship status. Citizens and non-citizens show a kind of similar distribution of income patterns. Also, the boxes are larger for males, which indicates more income variability for them. Having topcoded values gives more accurate median. If we truncate the top 2%, the mean might underestimate the true average.
ggplot(citizen_nlsy_df, aes(x = citizenship, y = total_income_2016, fill = gender)) +
  geom_boxplot(na.rm = TRUE) +
  scale_fill_manual(values = c("Male" = "#1f77b4", "Female" = "#ff7f0e")) +
  labs(
    title = "Income vs Citizenship Distribution by Gender",
    subtitle = "Including Topcoded Values",
    x = "Citizenship",
    y = "Total Income"
  )
```

## AGE vs INCOME

```{r}
# This will give us a tabular representation of age, mean, median, and sd. The possible age values are 12 to 16 where there are reasonable number of respondents for each age category. We can see that mean income is the highest for respondents of age 15 and lowest for age 12. The lowest median income is again for 12 years respondants and is 40000 for respondents of age 13, 14, and 16. We have filtered the rows where income is NA to get accurate number of male and female having respective mean, median, and sd. The table shows that there are 523 males and 499 females with mean income of 47192.36, median 39500, and sd 39106.02. Similarly we have data for different age across our respondents for a total of 2621 males and 2470 females.
age_income_summary <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>% # Exclude rows with NA in income
  group_by(age_1996) %>%
  summarize(
    count = n(),
    count_male = sum(gender == "Male", na.rm = TRUE),
    count_female = sum(gender == "Female", na.rm = TRUE),
    mean_income = mean(total_income_2016, na.rm = TRUE),
    median_income = median(total_income_2016, na.rm = TRUE),
    sd_income = sd(total_income_2016, na.rm = TRUE)
  )
print(age_income_summary)
```

```{r}
# Filter the data before creating the plot to remove the topcoded values. As we know there are 121 people having topcoded which is 2% level. There income has been average to 235884 and we plan to analyse the data for both with topcoded and without.
no_topcoded_nlsy_df <- nlsy_df %>%
  filter(total_income_2016 < 235884)

# Graph with topcoded income values
ggplot(nlsy_df, aes(x = age_1996, y = total_income_2016, color = gender)) +
  geom_jitter(alpha = 0.6, width = 0.4, height = 0, na.rm = TRUE) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Fig1. Income vs Age (1996) by Gender",
    subtitle = "Including Topcoded Values",
    x = "Age in 1996",
    y = "Income"
  ) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1", name = "Gender")

# Graph with no-topcoded income values will exclude the people with higher income and this will help us have even more accurate data as the topcoded income for 2% level is average and it might interfere in our analysis.
ggplot(no_topcoded_nlsy_df, aes(x = age_1996, y = total_income_2016, color = gender)) +
  geom_jitter(alpha = 0.6, na.rm = TRUE, width = 0.3, height = 0) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Fig2. Income vs Age (1996) by Gender",
    subtitle = "Excluding Topcoded Values",
    x = "Age in 1996",
    y = "Income"
  ) +
  theme_minimal() +
  scale_color_brewer(palette = "Set2", name = "Gender")

# Fig1. illustrates a plot for topcoded income vs age distributed by gender. Red point is for male and blue is for female. It shows income in the range $0-$236K. The age of respondents here is as of 12/31/1996. The graphs shows that the income for male is consistently higher than that for females across different ages 12,13,14,15,16. The trend line indicates that income is approximately $50K for males of age 12 to 14 whereas for females it is around $40K from the age 12 to 15. However, we see that income increased to $60K (approx) for male above the age of 14 and decreased to $35K(approx) for females above the age of 15.
# Fig2. depicts a plot for excluding topcoded income for 2% level. It shows income range in $0-$150K. Green point is for male and orange is for female. Here as the data has topcoded values truncated, the remains similar to the previous one. Male income starts from a little below $50K while females start around $37K which is lower as compared to fig1. The income goes slightly up for males above 14 and income goes down for females above the age of 15.
```

## USED MARIJUANA vs INCOME

```{r}
# This tabular below shows a tibble of 4x7 where we can see number of male and female having mean income based on usage of marijuana. There is a huge number of people 4078 who do not use marijuana and have a mean income of 49843.55. People who use marijuana constitutes to 994 out of which 534 are male and 460 are female who together have a mean income of 47958 which is lower when compared to people who don't use marijuana. However, category using marijuana and not using marijuana have same median of 40000. There are 3 males who say don't know have lowest mean income of 22266.67 and 11 male and 5 female refused to answer this question have the highest mean income of 55524.
mari_income_summary <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>% # Exclude rows with NA in income
  group_by(used_marijuana) %>%
  summarize(
    count = n(),
    count_male = sum(gender == "Male", na.rm = TRUE),
    count_female = sum(gender == "Female", na.rm = TRUE),
    mean_income = mean(total_income_2016, na.rm = TRUE),
    median_income = median(total_income_2016, na.rm = TRUE),
    sd_income = sd(total_income_2016, na.rm = TRUE)
  )
print(mari_income_summary)
```

```{r}
# This graph shows that males consistently show higher income levels across all marijuana use categories, with the most pronounced differences in the "Refusal" category. The income ranges from approximately $0 to $200,000. Don't know category shows lowest income with only male respondents, refusal shows a significant gender gap where males are making higher income than females, the No category shows both genders have similar high income with huge number of population lying in this category which can be seen by dark green and orange color and the Yes category also shows similar high income but for lower density of people. Hence, the data suggests that marijuana use itself doesn't show a clear negative correlation with income, as both "Yes" and "No" categories display similar income levels. The most significant variations appear to be driven by gender rather than marijuana use status.

ggplot(nlsy_df, aes(x = used_marijuana, y = total_income_2016, fill = gender)) +
  geom_col(position = "dodge", alpha = 0.7) +
  labs(
    title = "Income Distribution by Marijuana Use and Gender",
    subtitle = "Including Topcoded Values",
    x = "Used Marijuana",
    y = "Income"
  ) +
  scale_fill_brewer(palette = "Set2", name = "Gender") +
  theme_minimal()

# Similarly, let's see if truncating topcoded values show a difference.
ggplot(no_topcoded_nlsy_df, aes(x = used_marijuana, y = total_income_2016, fill = gender)) +
  geom_col(position = "dodge", alpha = 0.7) +
  labs(
    title = "Income Distribution by Marijuana Use and Gender",
    subtitle = "Excluding Topcoded Values",
    x = "Used Marijuana",
    y = "Income"
  ) +
  scale_fill_brewer(palette = "Set3", name = "Gender") +
  theme_minimal()

# If we analyze the graph we can say that the trend of income shows some variation when compared to graph with topcoded values. After removing extreme values, the income differences become more moderate. Gender disparities persist but are less dramatic when compared to graph with topcoded values. Here, the male in refusal category shows lower income as compared to female, for No category males earn slightly more than female and the highest income can be near approx 150K for males and 140K for females, for Yes category we see that both have similar income range. 
```	

## IS SAD DEPRESSED UNHAPPY vs INCOME BASED ON GENDER 

```{r}
# This table analyzes the relationship between income and reported feelings of sadness/depression, broken down by gender. The data shows 631 responses for 'Not true', 259 reponses for 'Sometimes true', and 24 responses for 'Often true'. This question shows sample is heavily skewed towards females, with only 4 male respondents. Mean income level is highest for people who don't feel depressed and lowest income is for respondents who often feel depressed or unhappy. Overall we get the idea that people who reported frequently feeling sadness or depression show lower income level among females. There is huge mean income gap of $13,383 between 'Not true' and 'Often true' category respondents.
sad_income_summary <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>% # Exclude rows with NA in income
  filter(!is.na(is_sad_depressed_unhappy_f)) %>% # Exclude rows with NA in is_sad
  group_by(is_sad_depressed_unhappy_f) %>%
  summarize(
    count = n(),
    count_male = sum(gender == "Male", na.rm = TRUE),
    count_female = sum(gender == "Female", na.rm = TRUE),
    mean_income = mean(total_income_2016, na.rm = TRUE),
    median_income = median(total_income_2016, na.rm = TRUE),
    sd_income = sd(total_income_2016, na.rm = TRUE)
  )
print(sad_income_summary)
```

```{r}
# Removing all NAs from is_sad variable and apply it to no-topcoded df
sad_income_df <- no_topcoded_nlsy_df %>%
  filter(!is.na(is_sad_depressed_unhappy_f))

# Here, we plan to exclude the topcoded values to avoid truncation of data. The graph displays the relationship between income distribution, sadness/depression levels, and gender using a scatter plot. The visualization shows income levels plotted against four categories of sadness/depression namely not true, sometimes true, and often true. We can say that income variability is the highest in 'Not true' and lowest in 'Often true'. 'Sometimes true' shows moderate spread of income ranging $0-$100000, 'Often true' shows smallest cluster with incomes ranging $0-$50000, and 'Not true' shows income ranging from $0-$150000. The data suggests that sadness/depression levels show some correlation with lower income levels, particularly for those reporting frequent sadness.
ggplot(sad_income_df, aes(x = is_sad_depressed_unhappy_f, y = total_income_2016, color = gender)) +
  geom_jitter(alpha = 0.6, width = 0.4, height = 0, na.rm = TRUE) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Income Distribution by Sadness Level and Gender",
    subtitle = "Excluding Topcoded Values",
    x = "Sadness/Depression Level",
    y = "Income"
  ) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1", name = "Gender")
```

## INDUSTRY CODE vs INCOME

```{r}
# Filtering NA from Industry Code
industry_code_nlsy_df <- nlsy_df %>%
  filter(!is.na(industry_code))%>%
  filter(!is.na(total_income_2016))

# Summarizing the Industry Code
industry_code_income_summary <- industry_code_nlsy_df %>%																									
group_by(industry_code) %>%																									
summarize(																									
count = n(),
count_male = sum(gender == "Male", na.rm = TRUE),
count_female = sum(gender == "Female", na.rm = TRUE),
mean_income = mean(total_income_2016, na.rm = TRUE),																									
median_income = median(total_income_2016, na.rm = TRUE),																									
sd_income = sd(total_income_2016, na.rm = TRUE)																									
)%>%
  arrange(desc(count))																									
print(industry_code_income_summary)																									
```	

The table above shows the count of respondents for different category of industry code, mean_income, median_income, and standard deviation. Here we can see that the mean income for different industry codes. The mean income for Mining is the highest and lowest for Entertainment, Accommodations, and Food Services. However, the median income for Utilities is the highest. Also, standard deviation for Active Duty Military is lowest compared to Finance, Insurance, and Real Estate respondents. The NA consists of valid skip which means the question was not applicable to those respondants and hence we have omitted it. Therefore, the data we see for industry codes in table or the graph will be for the 4650 responses as out of 8984 we omitted 4334 rows.

```{r}
# Create the bar plot for total income by industry code and gender
ggplot(industry_code_nlsy_df, aes(x = industry_code, y = total_income_2016, fill = gender)) +	
  geom_boxplot(na.rm=TRUE)+
  scale_fill_manual(values = c("Male" = "#1f77b4", "Female" = "#ff7f0e")) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Income vs Industry code by Gender",		
       subtitle = "Including Topcoded Values",
    x = "Industry code",																									
    y = "Total Income")	
```	

The above graph illustrates a plot for topcoded income vs industry code by gender. The blue boxes are for male and the orange ones are for females. The graphs shows that the income for male is consistently higher than that for females across different industry codes apart from ACS Special codes where it can be seen that females earn more than males.

## MARTIAL STATUS vs INCOME

```{r}
# Filtering NA from marital status
marital_status_nlsy_df <- nlsy_df %>%
  filter(!is.na(marital_status))%>%
filter(!is.na(total_income_2016))

# Summarizing the marital status
marital_status_income_summary <- marital_status_nlsy_df %>%																									
group_by(marital_status) %>%																									
summarize(																									
count = n(),
count_male = sum(gender == "Male", na.rm = TRUE),
count_female = sum(gender == "Female", na.rm = TRUE),
mean_income = round(mean(total_income_2016, na.rm = TRUE)),																									
median_income = round(median(total_income_2016, na.rm = TRUE)),																									
sd_income = round(sd(total_income_2016, na.rm = TRUE)), .groups = "drop"																								
)%>%
  arrange(desc(count))																									
print(marital_status_income_summary)																									
```	

The table above shows the count of respondents for different category of marital status, mean_income, median_income, and standard deviation. Here we can see that the mean income for different Marital statuses. The mean income for Married is the highest and lowest for Never-Married. However, the median income for Married is the highest but same for Never-Married and Others (combined: Separated, Divorced, Widowed ). Also, standard deviation for Never-married is lowest and for Married is highest. The NA consists of valid skip which means the question was not applicable to those respondants and hence we have omitted it. Therefore, the data we see for marital status in table or the graph will be for the 3924 responses as out of 8984 we omitted 5060 rows.

```{r}
# Filter data to exclude missing income values and focus on marital status
nlsy_married <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>%  
  filter(!is.na(marital_status))

# Create the bar plot for mean income by marital status and gender
ggplot(nlsy_married, aes(x = marital_status, y = total_income_2016, fill = gender)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  geom_text(aes(label = round(..y..)), stat = "summary", fun = "mean", position = position_dodge(width = 0.9), vjust = 6, size= 5 ) +
  labs(
    title = "Mean Income by Marital Status and Gender",
    subtitle = "Including Topcoded Values",
    x = "Marital Status",
    y = "Mean Income",
    fill = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

The above graph illustrates a plot for topcoded income vs marital status by gender. The red boxes are for male and the blue ones are for females. The graphs shows that the mean income for male is consistently higher than that for females across all marital statuses.

## INCARCERATIONS vs INCOME

```{r}
# Filtering NA from total number of Incarcerations
total_num_incarcerations_nlsy_df <- nlsy_df %>%
  filter(!is.na(total_num_incarcerations))%>%
  filter(!is.na(total_income_2016))

# Summarizing total number of Incarcerations
total_num_incarcerations_income_summary <- total_num_incarcerations_nlsy_df %>%																									
group_by(total_num_incarcerations) %>%																									
summarize(																									
count = n(),
count_male = sum(gender == "Male", na.rm = TRUE),
count_female = sum(gender == "Female", na.rm = TRUE),
mean_income = mean(total_income_2016, na.rm = TRUE),																									
median_income = median(total_income_2016, na.rm = TRUE),																									
sd_income = sd(total_income_2016, na.rm = TRUE)																									
)%>%
  arrange(desc(count))																									
print(total_num_incarcerations_income_summary)																									
```	

The table above shows the count of respondents with total number of incarcerations, mean_income, median_income, and standard deviation. Here we can see that the mean income for No incarcerations is the highest and lowest for 11 to 12 and 9 to 10 incarcerations. Similarly, the median income for No incarcerations is the highest and lowest for 11 to 12 incarcerations. Also, standard deviation for No incarcerations is the highest. We did remove the NA values but the NA values in the summary are likely occurring because some groups have only a single observation (e.g., the "11 to 12 incarcerations" and "9 to 10 incarcerations" categories). When calculating statistics like the standard deviation, the formula requires at least two values to compute a valid result. With only one value in a group, the standard deviation cannot be calculated, so it returns NA. The data we see for different incarcerations in table or the graph will be for the 3900 responses as out of 8984 we omitted 5084 rows.


```{r}
# Filter data to exclude missing income values and focus on incacerations
nlsy_incarcerations <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>%  
  filter(!is.na(total_num_incarcerations))

# Create the bar plot for mean income by  incacerations and gender
ggplot(nlsy_incarcerations, aes(x = total_num_incarcerations, y = total_income_2016, fill = gender)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  geom_text(aes(label = round(..y..)), stat = "summary", fun = "mean", position = position_dodge(width = 0.9), vjust = 0.1, size= 3.5 ) +
  labs(
    title = "Mean Income by Incarcerations and Gender",
    subtitle = "Including Topcoded Values",
    x = "Incarcerations",
    y = "Mean Income",
    fill = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

The above graph illustrates a plot for topcoded income vs incarcerations by gender. The red boxes are for male and the blue ones are for females. The graphs shows that the mean income for male is consistently higher than that for females even with different incarcerations they have had. However we do not see any mean income for females in the 7 to 8 and 11 to 12 incarcerations since we only have one respondent and we can assume that it was a male.

## COLLEGE TYPE vs INCOME

```{r}
# Filtering NA from college types
college_type_nlsy_df <- nlsy_df %>%
  filter(!is.na(college_type))%>%
  filter(!is.na(total_income_2016))

# Summarizing college types
college_type_income_summary <- college_type_nlsy_df %>%																									
group_by(college_type) %>%																									
summarize(																									
count = n(),
count_male = sum(gender == "Male", na.rm = TRUE),
count_female = sum(gender == "Female", na.rm = TRUE),
mean_income = mean(total_income_2016, na.rm = TRUE),																									
median_income = median(total_income_2016, na.rm = TRUE),																									
sd_income = sd(total_income_2016, na.rm = TRUE)																									
)																									
print(college_type_income_summary)																									
```	

The table above shows the count of respondents for different category of colleges, mean_income, median_income, and standard deviation. Here we can see that the mean income, median income and sd income for Private not-for-profit institution is the highest and lowest for Private for-profit institution. The NA consists of valid skip which means the question was not applicable to those respondants and hence we have omitted it. Therefore, the data we see for marital status in table or the graph will be for the 7958 responses as out of 8984 we omitted 1026 rows.

```{r}
# Filter data to exclude missing income values and focus on college types
nlsy_college <- nlsy_df %>%
  filter(!is.na(total_income_2016)) %>%  
  filter(!is.na(college_type))

# Create the bar plot for mean income by college types and gender
ggplot(nlsy_college, aes(x = college_type, y = total_income_2016, fill = gender)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge") +
  geom_text(aes(label = round(..y..)), stat = "summary", fun = "mean", position = position_dodge(width = 0.9), vjust = 6, size= 5 ) +
  labs(
    title = "Total Income by College type and Gender",
    subtitle = "Including Topcoded Values",
    x = "College Type",
    y = "Mean Income",
    fill = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 60, vjust = 1, hjust = 1))
```
The above graph illustrates a plot for topcoded income vs industry code by gender. The red boxes are for male and the blue ones are for females. The graphs shows that the income for male is consistently higher than that for females for all the three types of institutions.

## TRUSTFUL/DISTRUSTFUL vs INCOME

```{r}
# Filtering NA from trustful/distrustful
trustful_distrustful_nlsy_df <- nlsy_df %>%
  filter(!is.na(trustful_or_not))%>%
  filter(!is.na(total_income_2016))

# Summarizing trustful/distrustful
trustful_distrustful_income_summary <- trustful_distrustful_nlsy_df %>%																									
group_by(trustful_or_not) %>%																									
summarize(																									
count = n(),
count_male = sum(gender == "Male", na.rm = TRUE),
count_female = sum(gender == "Female", na.rm = TRUE),
mean_income = mean(total_income_2016, na.rm = TRUE),																									
median_income = median(total_income_2016, na.rm = TRUE),																									
sd_income = sd(total_income_2016, na.rm = TRUE)																									
)																									
print(trustful_distrustful_income_summary)																									
```	

The table above shows the count of respondents for Distrustful and Trustful, mean_income, median_income, and standard deviation. The mean income, median income and sd income for Trustful is the higher and lower for Distrustful. The NA consists of valid skip which means the question was not applicable to those respondants and hence we have omitted it. Therefore, the data we see for marital status in table or the graph will be for the 6044 responses as out of 8984 we omitted 2940 rows.

```{r}
# Filter data to exclude missing income values and focus on trustful/distrustful
trustful_distrustful_nlsy_df <- nlsy_df %>%
  filter(!is.na(trustful_or_not))%>%
  filter(!is.na(total_income_2016))

# Create the bar plot for mean income by trustful/distrustful and gender
ggplot(trustful_distrustful_nlsy_df, aes(x = trustful_or_not, y = total_income_2016, fill = gender)) +
  geom_bar(stat = "summary", position = "dodge") +
  geom_text(aes(label = round(..y..)), stat = "summary", position = position_dodge(width = 0.9), vjust = 6, size= 5 ) +
  labs(
    title = "Total Income by trustful/distrustful and Gender",
    subtitle = "Including Topcoded Values",
    x = "Trustful or Distrustful",
    y = "Mean Income",
    fill = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```
The above graph illustrates a plot for topcoded income vs respondents who are trustful/distrustful by gender. The red boxes are for male and the blue ones are for females. The graphs shows that the income for male is consistently higher than that for females for both who are trustful as well as distrustful.

## MEAN INCOME BY CURRENT ENROLLMENT STATUS AND GENDER

```{r}
# Calculate mean income for each enrollment status and gender, excluding missing values
nlsy_current_enr_df <- nlsy_df %>%
  filter(!is.na(total_income_2016), !is.na(current_enrollment_status)) %>%
  group_by(current_enrollment_status, gender) %>%
  summarize(
    `Mean Income` = mean(total_income_2016, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  rename(`Enrollment Status` = current_enrollment_status)

# Print the results
print(nlsy_current_enr_df)
```
From the above we can infer that the respondents who are currently enrolled in a 2-year college tend to earn highest average income(this includes the topcoded values). However there is a significant difference in the average income of Male and Female although they attended the same level of college and the Male population are earning more than Female.

```{r}
# Calculate mean income for each enrollment status and gender
nlsy_heatmap <- nlsy_df %>%
  filter(!is.na(total_income_2016), !is.na(current_enrollment_status)) %>%
  group_by(current_enrollment_status, gender) %>%
  summarize(mean_income = mean(total_income_2016, na.rm = TRUE), .groups = "drop")

# Create heatmap for mean income by the current enrollment status
ggplot(nlsy_heatmap, aes(x = gender, y = current_enrollment_status, fill = mean_income)) +
  geom_tile() +
  scale_fill_gradient(low = "blue", high = "brown", name = "Mean Income") +
  labs(
    title = "Mean Income Heatmap by Enrollment Status",
    subtitle = "Including Topcoded Values",
    x = "Gender",
    y = "Current Enrollment Status"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
From the Heatmap we can observe that Male and Female respondents who are attending same 2 year college degree but the male population is earning more average income compared to female respondents.

# PART 3 - NORMALITY CHECK, CI, HYPOTHESE TESTING AND REGRESSION

## NORMALITY CHECK

```{r}
# To check for normality of total_income_2016 we have performed the Skewness and Kurtosis tests to check for normality.

# Skewness:
# Close to 0: Symmetric distribution (normal-like).
# Positive: Right-skewed (tail extends to the right).
# Negative: Left-skewed (tail extends to the left).

skewness(nlsy_df$total_income_2016, na.rm = TRUE)

#Skewness = 2.435323: This indicates that the distribution of total_income_2016 is positively skewed, meaning it has a long right tail. The majority of the income values are concentrated toward the lower end, with fewer values extending toward the higher end. Hence it can be determined that the data deviates from normality.

# Kurtosis:
# Normal distribution has a kurtosis of 3.
# >3: Heavy-tailed distribution (leptokurtic).
# <3: Light-tailed distribution (platykurtic).

kurtosis(nlsy_df$total_income_2016, na.rm = TRUE)

# Kurtosis = 11.26869: This is significantly greater than 3, suggesting a leptokurtic distribution. This means the data has heavier tails and a sharper peak compared to a normal distribution. Hence it can be determined that the data deviates from normality.
```

## TOBIT REGRESSION TEST

We ran Tobit regression test as our data has top coded values. As p < 0.05, we can reject the Null Hypothesis (Ho) in support of Alternate Hypothesis (Ha) which states the difference in income for males and females is not equal to 0. We analyzed that females earn approximately $16180 less than males in terms of latent income (before censoring). Both the intercept, latent income and scale, and gender coefficient are highly statistically significant which means these effects are unlikely to be due to random chances but is something which is consistent across data. The 95% confidence interval [ 13747.84, 18099], t-value is 14.346, and p-value < 2.2e-16. The mean income for males is 57202.82 and females is 41278.92.

## WITH TOPCODED VALUES

### CONFIDENCE INTERVAL FOR TOPCODED
```{r}
# Filter dataset to exclude rows with missing income
filtered_data <- nlsy_df %>%
  filter(!is.na(total_income_2016))

# Perform t-test to calculate confidence interval for income by gender
gender_ci_top <- t.test(
  total_income_2016 ~ gender,
  data = filtered_data,
  conf.level = 0.95
)

# Print the t-test results
print(gender_ci_top)
```

The Welch Two-Sample t-test was conducted to examine the difference in mean income between males and females in the dataset with top-coded income values. We will consider the Null Hypothesis (Ho) as the mean income for males and females is equal. Alternate Hypothesis (Ha) as mean income for males and females are unequal. The test statistic t is 14.346, with a p-value < 2.2e-16 which indicates a highly significant result. This means we reject the null hypothesis and conclude that there is a statistically significant difference in mean income between males and females. A 95% confidence interval was calculated for the difference in mean income between males and females. The confidence interval is (13,747.84, 18,099.96). We can interpret that we are 95% confident that the true difference in mean income between males and females lies between $13,747.84 and $18,099.96, with males earning more on average. The average income for males is $57202.82 while for females it is $41278.92 and it highlights a substantial income disparity with top-coded values between the groups, with males earning approximately $15923 more than females on average.

### HYPOTHESES TEST FOR TOPCODED

```{r}
# Decision Rule
if (gender_ci_top$p.value < 0.05) {
  print("Reject the null hypothesis: Income significantly differs between males and females.")
} else {
  print("Fail to reject the null hypothesis: No significant income difference between males and females.")
}
```

The hypothesis test for top-coded income values examined whether there is a significant difference in mean income between males and females. The null hypothesis (Ho) assumes no difference, while the alternative hypothesis (Ha) suggests a significant difference. The Welch Two-Sample t-test yielded a p-value < 2.2e-16, far below the significance threshold (0.05). Consequently, the null hypothesis is rejected, indicating a statistically significant income disparity between genders, with males earning more on average.

### LINEAR REGRESSION MODEL FOR TOPCODED

```{r}
# Fit the regression model
lm_model <- lm(total_income_2016 ~ gender, data = filtered_data)

# Summarize the regression model
 summary(lm_model)
```

The linear regression model was used to analyze the relationship between gender and total income for top-coded values. The intercept (57,202.8) represents the average income for males, while the coefficient for genderFemale (−15,923.9) indicates that females earn, on average, $15,923.9 less than males. The p-value for the gender coefficient (<2.2×10 ^ −16) is highly significant, confirming that gender is a strong predictor of income in this dataset. However, the model explains only 3.8% of the variability in income (Adjusted R² =0.0381), suggesting other factors also contribute to income differences.

### PLOTS FOR TOPCODED

```{r}
# Diagnostic plots for regression model
par(mfrow = c(2, 2))  # Arrange plots in 2x2 grid
plot(lm_model)
```

1. Residuals vs. Fitted Plot: This plot assesses the linearity assumption. The residuals appear scattered but exhibit some clustering at extreme values, indicating possible deviations from linearity.
2. Q-Q Plot: The Q-Q plot evaluates the normality of residuals. The residuals deviate significantly from the diagonal line, particularly at the tails, suggesting the residuals are not normally distributed.
3. Scale-Location Plot: This plot checks for homoscedasticity (constant variance of residuals). The residuals' spread appears uneven, with greater variation at extreme fitted values, indicating heteroscedasticity.
4. Residuals vs. Leverage Plot: This plot identifies influential points. Several observations near the top right corner with high leverage suggest some data points may disproportionately impact the model.
These plots collectively highlight potential violations of regression assumptions, including non-normality, heteroscedasticity, and influential outliers. Adjustments or alternative modeling approaches may improve the model's validity and so we have also tested it for income truncating topcoded values.

## WITHOUT TOPCODED VALUES

### CONFIDENCE INTERVAL FOR NO-TOPCODED
```{r}
nlsy_no_topcoded <- nlsy_df %>%
  filter(total_income_2016 != max(total_income_2016, na.rm = TRUE))
# Filter dataset to exclude rows with missing income
notop_filtered_data <- nlsy_no_topcoded %>%
  filter(!is.na(total_income_2016))

# Perform t-test to calculate confidence interval for income by gender
gender_ci <- t.test(
  total_income_2016 ~ gender,
  data = notop_filtered_data,
  conf.level = 0.95
)

# Print the t-test results
print(gender_ci)
```

The Welch Two Sample t-test was performed to calculate the confidence interval for the difference in mean income between males and females, excluding topcoded values. After running the calculation, the t-statistic is 14.91, with degrees of freedom approximately 4938.7. The p-value is less than 2.2e-16, indicating strong evidence to reject the null hypothesis of no difference in mean income between males and females. The 95% confidence interval for the difference in means is [10,326.42, 13,453.00]. This interval does not include 0, further supporting the conclusion that a significant difference exists. The mean income for males is $50775 (approx) and $38886 (approx) for females. There is a statistically significant difference in mean income between males and females, with males earning, on average, significantly more than females in the dataset after excluding topcoded values which is similar to the trend as shown by topcoded test.

### HYPOTHESES TEST FOR NO-TOPCODED

```{r}
# Decision Rule
if (gender_ci$p.value < 0.05) {
  print("Reject the null hypothesis: Income significantly differs between males and females.")
} else {
  print("Fail to reject the null hypothesis: No significant income difference between males and females.")
}
```

The hypothesis test shows a statistically significant income difference between males and females after excluding topcoded values, as the p-value is less than 0.05 and so we reject the Ho in support of Ha.

### LINEAR REGRESSION MODEL FOR NO-TOPCODED
```{r}
# Fit the regression model
notop_lm_model <- lm(total_income_2016 ~ gender, data = notop_filtered_data)

# Summarize the regression model
 summary(notop_lm_model)
```

The linear regression model examines the relationship between total income (2016) and gender. The intercept, representing the average total income for males (reference category), is estimated at $50,775.90. The coefficient for genderFemale is -11,889.70, indicating that, on average, females earn $11,889.70 less than males in 2016, holding all else constant. This difference is highly statistically significant, as evidenced by a p-value < 2e-16. The residual standard error is 28,160, reflecting variability in income not explained by the model. The model explains only 4.27% of the variance in total income (R² = 0.04267), suggesting that gender alone is not a strong predictor of income. The overall model is significant (F(1, 4968) = 221.4, p-value < 2.2e-16).

### PLOTS FOR NO-TOPCODED
```{r}
# Diagnostic plots for regression model
par(mfrow = c(2, 2))  # Arrange plots in 2x2 grid
plot(notop_lm_model)
```

1. Residuals vs. Fitted Plot: The residuals are clustered tightly for smaller fitted values but become more spread at the upper end. Indicates heteroscedasticity (non-constant variance of residuals). There may also be outliers present, as some points deviate significantly from the zero line.

2. Normal Q-Q Plot: The residuals deviate from the straight diagonal line at both ends, particularly in the tails. Suggests the residuals are not normally distributed.

3. Scale-Location Plot: The spread of residuals increases slightly as fitted values increase. Indicates heteroscedasticity, confirming the findings from the Residuals vs. Fitted plot.

4. Residuals vs. Leverage Plot: Points near Cook's distance lines indicate high influence, though most points are clustered in low-leverage areas. A few data points may have high leverage or strong influence, warranting further investigation.

### LINEAR REGRESSION MODEL FOR NO-TOPCODED (MARITAL STATUS)
```{r}
# Fit the regression model
notop_lm_model_ms <- lm(total_income_2016 ~ gender + marital_status, data = notop_filtered_data)

# Summarize the regression model
 summary(notop_lm_model_ms)
```

The linear regression model examines the relationship between total income (2016) and the predictors: gender and marital status. The intercept, representing the estimated average income for males who are unmarried (reference group), is $45,071.70 and is statistically significant (p-value < 2e-16).

Gender: Females earn $11,905.50 less than males on average, a statistically significant difference (p-value < 2e-16).
Marital Status: Married individuals earn $11,542.00 more on average than unmarried individuals, a statistically significant effect (p-value < 2e-16). Individuals categorized as "Other" marital status earn $1,308.80 more than unmarried individuals, but this is not statistically significant (p-value = 0.302).
The residual standard error is 27,630, indicating the unexplained variability in income. The model explains 8.08% of the variance in income (R² = 0.08079), suggesting a modest explanatory power. The overall model is statistically significant (F(3, 4935) = 144.6, p-value < 2.2e-16). A total of 31 observations were excluded due to missing data.

### PLOTS FOR NO-TOPCODED (MARITAL STATUS)
```{r}
# Diagnostic plots for regression model
par(mfrow = c(2, 2))  # Arrange plots in 2x2 grid
plot(notop_lm_model_ms)
```

1. Residuals vs. Fitted: The residuals are scattered unevenly across the range of fitted values. There appears to be some clustering or systematic patterns, especially at lower fitted values. There may be issues with non-linearity or heteroscedasticity, suggesting that the model assumptions of linearity or equal variance might be violated.

2. Normal Q-Q Plot: Residuals deviate significantly from the theoretical quantile line in the tails. A visible "S" shape suggests non-normality of residuals. Statistical tests and confidence intervals derived from the model may be less reliable due to this non-normality.

3. Scale-Location (Spread-Location): The spread of residuals increases slightly with larger fitted values, as indicated by the upward trend in the red line. The model may suffer from mild heteroscedasticity, meaning the variance of residuals is not constant across levels of the predictors.

4. Residuals vs. Leverage: Points like 1672 and 1674 are potential high-leverage points, but they do not exceed Cook’s distance threshold. While these points are not excessively influential, they should be examined for potential outlier effects.

### LINEAR REGRESSION MODEL FOR NO-TOPCODED (AGE 1996 + CITIZENSHIP)
```{r}
# Fit the regression model
notop_lm_model_ag_ctz <- lm(total_income_2016 ~ gender + age_1996 + citizenship, data = notop_filtered_data)

# Summarize the regression model
 summary(notop_lm_model_ag_ctz)
```

The linear regression model evaluates the relationship between total income (2016) and three predictors: gender, age (1996), and citizenship status. The intercept, representing the average total income for males of age 0 (reference age) with unknown citizenship, is estimated at $43,763.80. The coefficient for genderFemale is -11,883.00, indicating that females earn $11,883.00 less than males on average, holding other variables constant. This difference is statistically significant (p-value < 2e-16). The coefficient for age_1996 is 646.00, suggesting that income increases by $646.00 for each additional year of age, which is statistically significant (p-value = 0.032). However, the coefficients for citizenshipCitizen and citizenshipNon-Citizen are not statistically significant (p-values of 0.352 and 0.889, respectively), indicating no significant effect of citizenship status on income.

The residual standard error is 28,020, showing variability in income not explained by the model. The model explains 4.47% of the variance in total income (R² = 0.04467), indicating a weak predictive capability. The overall model is statistically significant (F(4, 4439) = 51.89, p-value < 2.2e-16). Note that 526 observations were excluded due to missing data.

### PLOTS FOR NO-TOPCODED (AGE 1996 + CITIZENSHIP)
```{r}
# Diagnostic plots for regression model
par(mfrow = c(2, 2))  # Arrange plots in 2x2 grid
plot(notop_lm_model_ag_ctz)
```

1. Residuals vs. Fitted: Residuals are scattered around zero but appear to show non-random patterns. Some clustering may indicate mild issues with linearity or omitted variables. There may be slight violations of linearity or homoscedasticity.

2. Normal Q-Q Plot: The residuals follow the diagonal line reasonably well in the middle but deviate in the tails. The departure at both ends indicates potential non-normality of residuals. Inferences might be slightly affected, particularly for tests or confidence intervals.

3. Scale-Location (Spread-Location): The red line is mostly flat, but the spread of residuals increases slightly as fitted values grow. Indicates mild heteroscedasticity. Variance may not be constant, which could affect model accuracy.

4. Residuals vs. Leverage: Points like 244, 1200, and 3220 show relatively high leverage. None of the observations exceed Cook's distance threshold, meaning their influence is limited. These points should still be reviewed for potential impact on model performance.


### LINEAR REGRESSION MODEL FOR NO-TOPCODED (RACE + USED MARIJUANA + INDUSTRY CODE)
```{r}
# Fit the regression model
notop_lm_model_rc_um_ic <- lm(total_income_2016 ~ gender + race + used_marijuana + industry_code, data = notop_filtered_data)

# Summarize the regression model
 summary(notop_lm_model_rc_um_ic)
```

The linear regression model explores the relationship between total income (2016) and the predictors: gender, race, used_marijuana, and industry_code. The intercept, representing the estimated average income for males of the "White" race, who have not responded about marijuana usage, and with the reference industry, is $21,000.00 but is not statistically significant (p-value = 0.3276).

Gender: Females earn $10,252.50 less than males on average, a statistically significant difference (p-value < 2e-16).
Race: Compared to the reference race ("White"), Hispanic individuals earn $6,606.70 more on average (p-value = 1.17e-07), while individuals of "Other" races earn $12,904.60 more on average (p-value < 2e-16).
Used_marijuana: None of the levels (Refusal, No, Yes) showed a significant effect on income.
Industry_code: Two industries showed significant effects on income. Workers in the "Mining" industry earn $23,903.50 more on average (p-value = 0.0287), and those in "Utilities" earn $26,103.00 more on average (p-value = 0.0191) compared to the reference industry.
The residual standard error is 27,110, indicating the variation in income not explained by the model. The model explains 12.77% of the variance in income (R² = 0.1277), suggesting moderate explanatory power. The overall model is statistically significant (F(22, 4204) = 27.96, p-value < 2.2e-16). Note that 743 observations were excluded due to missing data.

### PLOTS FOR NO-TOPCODED (RACE + USED MARIJUANA + INDUSTRY CODE)
```{r}
# Diagnostic plots for regression model
par(mfrow = c(2, 2))  # Arrange plots in 2x2 grid
plot(notop_lm_model_rc_um_ic)
```

1. Residuals vs. Fitted: The residuals are scattered around zero, but there is some noticeable spread variation. There may be mild signs of heteroscedasticity, as the variance increases slightly with the fitted values. This suggests that the model may not perfectly meet the assumption of homoscedasticity.

2. Normal Q-Q Plot: The residuals deviate from the diagonal line, especially at the tails, indicating that the residuals are not perfectly normal. This might affect inference (e.g., confidence intervals and p-values).

3. Scale-Location (Spread-Location): The red line is relatively flat, but there is some variation in the spread of points. The heteroscedasticity detected in the first plot is confirmed here. Indicates that the model's variance might not be constant across the range of fitted values.

4. Residuals vs. Leverage: Points like 120, 4628, and 1712 are flagged as having high leverage. No point crosses the Cook's distance threshold (indicated by the dashed lines), so no observation appears to be highly influential. No extreme leverage points, but observations with high leverage should be examined.

# PART 4 - STORYTELLING

## METHODOLOGY

## HANDLING MISSING VALUES

## HANDLING TOPCODED VARIABLES

# PART 5 - CONCLUSION

